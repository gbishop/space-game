!function(I){var g={};function C(A){if(g[A])return g[A].exports;var t=g[A]={i:A,l:!1,exports:{}};return I[A].call(t.exports,t,t.exports,C),t.l=!0,t.exports}C.m=I,C.c=g,C.d=function(I,g,A){C.o(I,g)||Object.defineProperty(I,g,{enumerable:!0,get:A})},C.r=function(I){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})},C.t=function(I,g){if(1&g&&(I=C(I)),8&g)return I;if(4&g&&"object"==typeof I&&I&&I.__esModule)return I;var A=Object.create(null);if(C.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:I}),2&g&&"string"!=typeof I)for(var t in I)C.d(A,t,function(g){return I[g]}.bind(null,t));return A},C.n=function(I){var g=I&&I.__esModule?function(){return I.default}:function(){return I};return C.d(g,"a",g),g},C.o=function(I,g){return Object.prototype.hasOwnProperty.call(I,g)},C.p="",C(C.s=1)}([function(module,exports){eval("module.exports = Phaser;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJQaGFzZXJcIj9lYmM2Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IFBoYXNlcjsiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: external "Phaser"\nvar external_Phaser_ = __webpack_require__(0);\n\n// CONCATENATED MODULE: ./src/settings.ts\nconst key = "space-config";\nconst version = 2;\nclass Settings {\n    constructor() {\n        this.mode = "auto";\n        this.sound = true;\n        this.asteroids = true;\n    }\n    persist() {\n        const data = {\n            version: version,\n            mode: this.mode,\n            sound: this.sound,\n            asteroids: this.asteroids\n        };\n        const json = JSON.stringify(data);\n        localStorage.setItem(key, json);\n    }\n    restore() {\n        const json = localStorage.getItem(key);\n        if (json) {\n            const data = JSON.parse(json);\n            if (data.version == version) {\n                this.mode = data.mode;\n                this.sound = data.sound;\n                this.asteroids = data.asteroids;\n            }\n        }\n    }\n}\nconst settings = new Settings();\nsettings.restore();\n/* harmony default export */ var src_settings = (settings);\n\n// CONCATENATED MODULE: ./src/base.ts\n\n\nclass SwitchBase extends Phaser.Scene {\n    constructor(args) {\n        super(args);\n        this.initialized = false;\n    }\n    getUserInput(correct, func) {\n        if (!this.initialized) {\n            this.events.on("resume", (s, d) => this.userInput(d.choice));\n            /* There is a bug in run, now fixed but not yet released that makes\n             * it recreate instead of restarting a paused scene. I\'ll work around\n             * that by always resuming but I\'ll first need to run to get it started.\n             * I\'ll remove this when run gets released */\n            this.scene.run("ControlScene");\n            this.scene.pause("ControlScene");\n            this.initialized = true;\n        }\n        let inputConfig = { caller: this.scene.key, correct };\n        this.scene.resume("ControlScene", inputConfig);\n        this.scene.pause();\n        this.callback = func;\n    }\n    userInput(choice) {\n        // this method will be called with the user\'s response\n        this.callback(choice);\n    }\n}\nclass base_ControlScene extends Phaser.Scene {\n    constructor() {\n        super({\n            key: "ControlScene"\n        });\n    }\n    returnInput(value) {\n        if (src_settings.mode == "one") {\n            value = this.inputConfig.correct;\n        }\n        this.scene.resume(this.inputConfig.caller, { choice: value });\n        this.scene.pause();\n    }\n    setSelected(choice) {\n        const choices = document.querySelectorAll("button.choice");\n        let selected = document.querySelector("button.selected");\n        if (selected) {\n            selected.classList.remove("selected");\n        }\n        choices[choice].classList.add("selected");\n    }\n    create() {\n        console.log("create control");\n        this.input.keyboard.on("keydown-LEFT", (e) => {\n            // pass response back to caller\n            this.returnInput(0);\n        });\n        this.input.keyboard.on("keydown-RIGHT", (e) => {\n            // pass response back to caller\n            this.returnInput(1);\n        });\n        this.events.on("resume", (e, d) => {\n            this.inputConfig = d;\n            this.scene.pause(d.caller);\n            if (src_settings.mode == "auto") {\n                this.time.delayedCall(1000, () => {\n                    this.setSelected(this.inputConfig.correct);\n                    this.returnInput(this.inputConfig.correct);\n                }, [], this);\n            }\n        });\n        document\n            .getElementById("left")\n            .addEventListener("click", e => this.returnInput(0));\n        document\n            .getElementById("right")\n            .addEventListener("click", e => this.returnInput(1));\n        this.input.keyboard.on("keydown-SPACE", (e) => {\n            const choices = document.querySelectorAll("button.choice");\n            let selected = document.querySelector("button.selected");\n            let i = 0;\n            if (selected) {\n                i = ([...choices].indexOf(selected) + 1) % choices.length;\n                selected.classList.remove("selected");\n            }\n            choices[i].classList.add("selected");\n        });\n        this.input.keyboard.on("keydown-ENTER", (e) => {\n            const selected = (document.querySelector("button.selected"));\n            if (selected) {\n                selected.click();\n            }\n        });\n    }\n}\n\n// CONCATENATED MODULE: ./src/game.ts\n\n\n\nclass game_GameScene extends SwitchBase {\n    constructor() {\n        super({\n            key: "GameScene"\n        });\n        this.elapsed = 0;\n        this.previous = 0; // previous elapsed\n        this.period = 2; // time per cycle\n        this.canvas = document.querySelector("canvas");\n        this.lane = 0;\n        this.rocket_lane = 1;\n        this.rocket_y = 0;\n        this.sign = 1;\n        this.freq = 1.5;\n        this.score = 0;\n        this.popSound = null;\n        this.alienSound = null;\n        this.explodeSound = null;\n    }\n    preload() {\n        // this.load.image("alien", "assets/alien.png");\n        this.load.spritesheet("alien", "assets/alien-sheet.png", {\n            frameWidth: 73,\n            frameHeight: 44,\n            startFrame: 0,\n            endFrame: 39\n        });\n        this.load.spritesheet("asteroid", "assets/asteroid-sheet.png", {\n            frameWidth: 120,\n            frameHeight: 120,\n            startFrame: 0,\n            endFrame: 15\n        });\n        this.load.image("rocket", "assets/rocket.png");\n        this.load.image("particle", "assets/particle.png");\n        if (src_settings.sound) {\n            this.load.audio("pop", "assets/success.mp3");\n            this.load.audio("alienSound", "assets/alien.mp3");\n            this.load.audio("explodeSound", "assets/explode.mp3");\n        }\n    }\n    create() {\n        console.log("create game");\n        this.scoreDisplay = this.add.text(20, 20, "0", { fontSize: 20 });\n        this.rocket_y = this.canvas.height * 0.9;\n        this.alien = this.add.sprite(this.canvas.width / 2, 10, "alien");\n        for (let i = 0; i < 10; i++) {\n            let name = `ship${i}`;\n            let a = this.anims.create({\n                key: name,\n                frames: this.anims.generateFrameNumbers("alien", {\n                    start: i * 4,\n                    end: i * 4 + 3\n                }),\n                frameRate: 2,\n                repeat: -1\n            });\n            this.alien.anims.load(name);\n        }\n        this.asteroid = this.add.sprite(0, 0, "asteroid");\n        let anim = this.anims.create({\n            key: "spin",\n            frames: this.anims.generateFrameNumbers("asteroid", {}),\n            frameRate: 20,\n            repeat: -1\n        });\n        this.asteroid.anims.load("spin");\n        this.asteroid.anims.play("spin");\n        this.rocket = this.add.sprite((3 * this.canvas.width) / 4, this.rocket_y, "rocket");\n        this.rocket.setScale(0.5);\n        this.moveLeft = this.tweens.add({\n            targets: this.rocket,\n            props: {\n                x: { value: this.canvas.width / 4, duration: 500 },\n                rotation: {\n                    value: -Math.PI / 2,\n                    duration: 250,\n                    yoyo: true,\n                    repeat: 0,\n                    ease: "Sine.easeInOut"\n                }\n            },\n            paused: true\n        });\n        this.moveRight = this.tweens.add({\n            targets: this.rocket,\n            props: {\n                x: { value: (3 * this.canvas.width) / 4, duration: 500 },\n                rotation: { value: Math.PI / 2, duration: 250, yoyo: true, repeat: 0 }\n            },\n            paused: true\n        });\n        // Enable physics on rocket and alien sprites\n        this.physics.world.enable([this.rocket, this.alien, this.asteroid]);\n        this.collider = this.physics.add.overlap(this.rocket, [this.alien, this.asteroid], this.rocketCollideWithAlien, null, this);\n        this.particles = this.add.particles("particle");\n        this.emitter = this.particles.createEmitter({\n            angle: { min: 0, max: 360 },\n            speed: { min: 50, max: 200 },\n            quantity: { min: 40, max: 50 },\n            lifespan: { min: 200, max: 500 },\n            alpha: { start: 1, end: 0 },\n            scale: { min: 0.5, max: 0.5 },\n            rotate: { start: 0, end: 360 },\n            gravityY: 800,\n            on: false\n        });\n        this.reset();\n        if (src_settings.sound) {\n            this.popSound = this.sound.add("pop");\n            this.alienSound = (this.sound.add("alienSound"));\n            this.alienSound.setLoop(true);\n            this.alienSound.play();\n            this.explodeSound = (this.sound.add("explodeSound"));\n        }\n    }\n    reset() {\n        const w = this.canvas.width;\n        this.elapsed = 0;\n        this.lane = Phaser.Math.Between(0, 1);\n        this.sign = 2 * Phaser.Math.Between(0, 1) - 1;\n        this.freq = 0.5 + Math.random() * 2;\n        if (this.score < 20 || Math.random() > 0.2) {\n            this.target = this.alien;\n            let name = `ship${Phaser.Math.Between(0, 9)}`;\n            this.alien.anims.play(name);\n            this.asteroid.y = -100;\n            if (this.alienSound) {\n                this.alienSound.setSeek(0);\n                this.alienSound.setRate(this.freq);\n                this.alienSound.play();\n            }\n        }\n        else {\n            this.target = this.asteroid;\n            this.alien.y = -100;\n            if (this.alienSound)\n                this.alienSound.stop();\n        }\n        this.target.setVisible(true);\n        this.collider.active = true;\n    }\n    update(time, delta) {\n        const w = this.canvas.width;\n        const h = this.canvas.height;\n        this.previous = this.elapsed;\n        this.elapsed += delta * 0.001;\n        // update when the period is exceeded\n        if (this.elapsed > this.period) {\n            this.reset();\n        }\n        // pause when we pass the decision time\n        const decision_time = this.period * 0.5;\n        if (this.previous < decision_time && this.elapsed >= decision_time) {\n            this.getUserInput(this.target === this.alien ? this.lane : 1 - this.lane, \n            // (v: number) => (this.rocket_lane = v)\n            (v) => {\n                const rocket_x = w / 4 + (v * w) / 2;\n                if (this.rocket.x < rocket_x) {\n                    this.moveRight.play();\n                }\n                else if (this.rocket.x > rocket_x) {\n                    this.moveLeft.play();\n                }\n            });\n        }\n        const u = this.elapsed / this.period;\n        const goal_x = w / 4 + (this.lane * w) / 2;\n        const wiggle = w / 2 +\n            ((Math.min(10, this.score) * w) / 20) *\n                (this.sign * Math.sin(2 * Math.PI * this.freq * u));\n        const v = Math.min(1, (h / this.rocket_y) * u);\n        this.target.x = (1 - v) * wiggle + v * goal_x;\n        this.target.y = this.canvas.height * u;\n        if (this.alienSound)\n            this.alienSound.setVolume(u);\n        if (u % 0.2 < 1 / 60) {\n            // this.alien.setTint(0xffffff * Math.random());\n        }\n    }\n    rocketCollideWithAlien() {\n        // this.sound.play("pop");\n        if (this.target == this.alien) {\n            if (this.popSound)\n                this.popSound.play();\n            this.cameras.main.flash();\n        }\n        else {\n            if (this.explodeSound)\n                this.explodeSound.play();\n            this.cameras.main.flash(500, 255, 0, 0);\n        }\n        // flash\n        // Hide the alien\n        this.target.visible = false;\n        // prevent multiple collisions\n        this.collider.active = false;\n        // blowup\n        this.particles.emitParticleAt(this.target.x, this.target.y);\n        // update score\n        this.score += this.target === this.alien ? 1 : -1;\n        this.scoreDisplay.setText("" + this.score);\n    }\n}\n\n// CONCATENATED MODULE: ./src/app.ts\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MyGame", function() { return MyGame; });\n\n\n\n\nconst config = {\n    title: "Space",\n    type: Phaser.AUTO,\n    width: 600,\n    height: 800,\n    scale: {\n        mode: Phaser.Scale.RESIZE,\n        autoCenter: Phaser.Scale.CENTER_BOTH\n    },\n    parent: "game",\n    scene: [game_GameScene, base_ControlScene],\n    physics: {\n        default: "arcade",\n        arcade: {\n            debug: false\n        }\n    },\n    backgroundColor: "#444444"\n};\nclass MyGame extends Phaser.Game {\n    constructor(config) {\n        super(config);\n    }\n}\nwindow.onload = () => {\n    let game = null;\n    document.getElementById("setup").addEventListener("click", () => {\n        if (game) {\n            game.destroy(true);\n            game = null;\n        }\n        document.body.classList.value = "settings";\n    });\n    document.getElementById("playButton").addEventListener("click", () => {\n        document.body.classList.value = "play";\n        game = new MyGame(config);\n    });\n    [...document.querySelectorAll("input[name=mode]")].map((node) => (node.checked = node.value == src_settings.mode));\n    const soundInput = document.getElementById("sound");\n    soundInput.checked = src_settings.sound;\n    const asteroidsInput = document.getElementById("asteroids");\n    asteroidsInput.checked = src_settings.asteroids;\n    document.getElementById("settings").addEventListener("change", e => {\n        console.log("change");\n        const modeInput = (document.querySelector("input[name=mode]:checked"));\n        const mode = modeInput.value;\n        src_settings.mode = mode;\n        const soundInput = document.getElementById("sound");\n        src_settings.sound = soundInput.checked;\n        const asteroidsInput = (document.getElementById("asteroids"));\n        src_settings.asteroids = asteroidsInput.checked;\n        src_settings.persist();\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvc2V0dGluZ3MudHM/YzIzYyIsIndlYnBhY2s6Ly8vLi9zcmMvYmFzZS50cz9hZTgzIiwid2VicGFjazovLy8uL3NyYy9nYW1lLnRzP2FhZmMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FwcC50cz9mMWIyIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDZSx5REFBUSxFQUFDOzs7QUNoQ1I7QUFDa0I7QUFDM0I7QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sTUFBTSxpQkFBWTtBQUN6QjtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFlBQVksWUFBUTtBQUNwQjtBQUNBO0FBQ0Esb0RBQW9ELGdCQUFnQjtBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQixZQUFRO0FBQ3hCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FB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LFFBQVEsWUFBUTtBQUNoQixLQUFLO0FBQ0wiLCJmaWxlIjoiMS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGtleSA9IFwic3BhY2UtY29uZmlnXCI7XG5jb25zdCB2ZXJzaW9uID0gMjtcbmNsYXNzIFNldHRpbmdzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5tb2RlID0gXCJhdXRvXCI7XG4gICAgICAgIHRoaXMuc291bmQgPSB0cnVlO1xuICAgICAgICB0aGlzLmFzdGVyb2lkcyA9IHRydWU7XG4gICAgfVxuICAgIHBlcnNpc3QoKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uLFxuICAgICAgICAgICAgbW9kZTogdGhpcy5tb2RlLFxuICAgICAgICAgICAgc291bmQ6IHRoaXMuc291bmQsXG4gICAgICAgICAgICBhc3Rlcm9pZHM6IHRoaXMuYXN0ZXJvaWRzXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBqc29uKTtcbiAgICB9XG4gICAgcmVzdG9yZSgpIHtcbiAgICAgICAgY29uc3QganNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgICAgIGlmIChqc29uKSB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShqc29uKTtcbiAgICAgICAgICAgIGlmIChkYXRhLnZlcnNpb24gPT0gdmVyc2lvbikge1xuICAgICAgICAgICAgICAgIHRoaXMubW9kZSA9IGRhdGEubW9kZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNvdW5kID0gZGF0YS5zb3VuZDtcbiAgICAgICAgICAgICAgICB0aGlzLmFzdGVyb2lkcyA9IGRhdGEuYXN0ZXJvaWRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuY29uc3Qgc2V0dGluZ3MgPSBuZXcgU2V0dGluZ3MoKTtcbnNldHRpbmdzLnJlc3RvcmUoKTtcbmV4cG9ydCBkZWZhdWx0IHNldHRpbmdzO1xuIiwiaW1wb3J0IFwicGhhc2VyXCI7XG5pbXBvcnQgc2V0dGluZ3MgZnJvbSBcIi4vc2V0dGluZ3NcIjtcbmV4cG9ydCBjbGFzcyBTd2l0Y2hCYXNlIGV4dGVuZHMgUGhhc2VyLlNjZW5lIHtcbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gZmFsc2U7XG4gICAgfVxuICAgIGdldFVzZXJJbnB1dChjb3JyZWN0LCBmdW5jKSB7XG4gICAgICAgIGlmICghdGhpcy5pbml0aWFsaXplZCkge1xuICAgICAgICAgICAgdGhpcy5ldmVudHMub24oXCJyZXN1bWVcIiwgKHMsIGQpID0+IHRoaXMudXNlcklucHV0KGQuY2hvaWNlKSk7XG4gICAgICAgICAgICAvKiBUaGVyZSBpcyBhIGJ1ZyBpbiBydW4sIG5vdyBmaXhlZCBidXQgbm90IHlldCByZWxlYXNlZCB0aGF0IG1ha2VzXG4gICAgICAgICAgICAgKiBpdCByZWNyZWF0ZSBpbnN0ZWFkIG9mIHJlc3RhcnRpbmcgYSBwYXVzZWQgc2NlbmUuIEknbGwgd29yayBhcm91bmRcbiAgICAgICAgICAgICAqIHRoYXQgYnkgYWx3YXlzIHJlc3VtaW5nIGJ1dCBJJ2xsIGZpcnN0IG5lZWQgdG8gcnVuIHRvIGdldCBpdCBzdGFydGVkLlxuICAgICAgICAgICAgICogSSdsbCByZW1vdmUgdGhpcyB3aGVuIHJ1biBnZXRzIHJlbGVhc2VkICovXG4gICAgICAgICAgICB0aGlzLnNjZW5lLnJ1bihcIkNvbnRyb2xTY2VuZVwiKTtcbiAgICAgICAgICAgIHRoaXMuc2NlbmUucGF1c2UoXCJDb250cm9sU2NlbmVcIik7XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgaW5wdXRDb25maWcgPSB7IGNhbGxlcjogdGhpcy5zY2VuZS5rZXksIGNvcnJlY3QgfTtcbiAgICAgICAgdGhpcy5zY2VuZS5yZXN1bWUoXCJDb250cm9sU2NlbmVcIiwgaW5wdXRDb25maWcpO1xuICAgICAgICB0aGlzLnNjZW5lLnBhdXNlKCk7XG4gICAgICAgIHRoaXMuY2FsbGJhY2sgPSBmdW5jO1xuICAgIH1cbiAgICB1c2VySW5wdXQoY2hvaWNlKSB7XG4gICAgICAgIC8vIHRoaXMgbWV0aG9kIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlIHVzZXIncyByZXNwb25zZVxuICAgICAgICB0aGlzLmNhbGxiYWNrKGNob2ljZSk7XG4gICAgfVxufVxuZXhwb3J0IGNsYXNzIENvbnRyb2xTY2VuZSBleHRlbmRzIFBoYXNlci5TY2VuZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKHtcbiAgICAgICAgICAgIGtleTogXCJDb250cm9sU2NlbmVcIlxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuSW5wdXQodmFsdWUpIHtcbiAgICAgICAgaWYgKHNldHRpbmdzLm1vZGUgPT0gXCJvbmVcIikge1xuICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmlucHV0Q29uZmlnLmNvcnJlY3Q7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zY2VuZS5yZXN1bWUodGhpcy5pbnB1dENvbmZpZy5jYWxsZXIsIHsgY2hvaWNlOiB2YWx1ZSB9KTtcbiAgICAgICAgdGhpcy5zY2VuZS5wYXVzZSgpO1xuICAgIH1cbiAgICBzZXRTZWxlY3RlZChjaG9pY2UpIHtcbiAgICAgICAgY29uc3QgY2hvaWNlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b24uY2hvaWNlXCIpO1xuICAgICAgICBsZXQgc2VsZWN0ZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnNlbGVjdGVkXCIpO1xuICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIHNlbGVjdGVkLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBjaG9pY2VzW2Nob2ljZV0uY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuICAgIH1cbiAgICBjcmVhdGUoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiY3JlYXRlIGNvbnRyb2xcIik7XG4gICAgICAgIHRoaXMuaW5wdXQua2V5Ym9hcmQub24oXCJrZXlkb3duLUxFRlRcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIC8vIHBhc3MgcmVzcG9uc2UgYmFjayB0byBjYWxsZXJcbiAgICAgICAgICAgIHRoaXMucmV0dXJuSW5wdXQoMCk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlucHV0LmtleWJvYXJkLm9uKFwia2V5ZG93bi1SSUdIVFwiLCAoZSkgPT4ge1xuICAgICAgICAgICAgLy8gcGFzcyByZXNwb25zZSBiYWNrIHRvIGNhbGxlclxuICAgICAgICAgICAgdGhpcy5yZXR1cm5JbnB1dCgxKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZXZlbnRzLm9uKFwicmVzdW1lXCIsIChlLCBkKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlucHV0Q29uZmlnID0gZDtcbiAgICAgICAgICAgIHRoaXMuc2NlbmUucGF1c2UoZC5jYWxsZXIpO1xuICAgICAgICAgICAgaWYgKHNldHRpbmdzLm1vZGUgPT0gXCJhdXRvXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWUuZGVsYXllZENhbGwoMTAwMCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFNlbGVjdGVkKHRoaXMuaW5wdXRDb25maWcuY29ycmVjdCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmV0dXJuSW5wdXQodGhpcy5pbnB1dENvbmZpZy5jb3JyZWN0KTtcbiAgICAgICAgICAgICAgICB9LCBbXSwgdGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBkb2N1bWVudFxuICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKFwibGVmdFwiKVxuICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHRoaXMucmV0dXJuSW5wdXQoMCkpO1xuICAgICAgICBkb2N1bWVudFxuICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKFwicmlnaHRcIilcbiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB0aGlzLnJldHVybklucHV0KDEpKTtcbiAgICAgICAgdGhpcy5pbnB1dC5rZXlib2FyZC5vbihcImtleWRvd24tU1BBQ0VcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNob2ljZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiYnV0dG9uLmNob2ljZVwiKTtcbiAgICAgICAgICAgIGxldCBzZWxlY3RlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24uc2VsZWN0ZWRcIik7XG4gICAgICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBpID0gKFsuLi5jaG9pY2VzXS5pbmRleE9mKHNlbGVjdGVkKSArIDEpICUgY2hvaWNlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2hvaWNlc1tpXS5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlucHV0LmtleWJvYXJkLm9uKFwia2V5ZG93bi1FTlRFUlwiLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJ1dHRvbi5zZWxlY3RlZFwiKSk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZC5jbGljaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCJpbXBvcnQgXCJwaGFzZXJcIjtcbmltcG9ydCB7IFN3aXRjaEJhc2UgfSBmcm9tIFwiLi9iYXNlXCI7XG5pbXBvcnQgc2V0dGluZ3MgZnJvbSBcIi4vc2V0dGluZ3NcIjtcbmV4cG9ydCBjbGFzcyBHYW1lU2NlbmUgZXh0ZW5kcyBTd2l0Y2hCYXNlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoe1xuICAgICAgICAgICAga2V5OiBcIkdhbWVTY2VuZVwiXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmVsYXBzZWQgPSAwO1xuICAgICAgICB0aGlzLnByZXZpb3VzID0gMDsgLy8gcHJldmlvdXMgZWxhcHNlZFxuICAgICAgICB0aGlzLnBlcmlvZCA9IDI7IC8vIHRpbWUgcGVyIGN5Y2xlXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKTtcbiAgICAgICAgdGhpcy5sYW5lID0gMDtcbiAgICAgICAgdGhpcy5yb2NrZXRfbGFuZSA9IDE7XG4gICAgICAgIHRoaXMucm9ja2V0X3kgPSAwO1xuICAgICAgICB0aGlzLnNpZ24gPSAxO1xuICAgICAgICB0aGlzLmZyZXEgPSAxLjU7XG4gICAgICAgIHRoaXMuc2NvcmUgPSAwO1xuICAgICAgICB0aGlzLnBvcFNvdW5kID0gbnVsbDtcbiAgICAgICAgdGhpcy5hbGllblNvdW5kID0gbnVsbDtcbiAgICAgICAgdGhpcy5leHBsb2RlU291bmQgPSBudWxsO1xuICAgIH1cbiAgICBwcmVsb2FkKCkge1xuICAgICAgICAvLyB0aGlzLmxvYWQuaW1hZ2UoXCJhbGllblwiLCBcImFzc2V0cy9hbGllbi5wbmdcIik7XG4gICAgICAgIHRoaXMubG9hZC5zcHJpdGVzaGVldChcImFsaWVuXCIsIFwiYXNzZXRzL2FsaWVuLXNoZWV0LnBuZ1wiLCB7XG4gICAgICAgICAgICBmcmFtZVdpZHRoOiA3MyxcbiAgICAgICAgICAgIGZyYW1lSGVpZ2h0OiA0NCxcbiAgICAgICAgICAgIHN0YXJ0RnJhbWU6IDAsXG4gICAgICAgICAgICBlbmRGcmFtZTogMzlcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubG9hZC5zcHJpdGVzaGVldChcImFzdGVyb2lkXCIsIFwiYXNzZXRzL2FzdGVyb2lkLXNoZWV0LnBuZ1wiLCB7XG4gICAgICAgICAgICBmcmFtZVdpZHRoOiAxMjAsXG4gICAgICAgICAgICBmcmFtZUhlaWdodDogMTIwLFxuICAgICAgICAgICAgc3RhcnRGcmFtZTogMCxcbiAgICAgICAgICAgIGVuZEZyYW1lOiAxNVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwicm9ja2V0XCIsIFwiYXNzZXRzL3JvY2tldC5wbmdcIik7XG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInBhcnRpY2xlXCIsIFwiYXNzZXRzL3BhcnRpY2xlLnBuZ1wiKTtcbiAgICAgICAgaWYgKHNldHRpbmdzLnNvdW5kKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWQuYXVkaW8oXCJwb3BcIiwgXCJhc3NldHMvc3VjY2Vzcy5tcDNcIik7XG4gICAgICAgICAgICB0aGlzLmxvYWQuYXVkaW8oXCJhbGllblNvdW5kXCIsIFwiYXNzZXRzL2FsaWVuLm1wM1wiKTtcbiAgICAgICAgICAgIHRoaXMubG9hZC5hdWRpbyhcImV4cGxvZGVTb3VuZFwiLCBcImFzc2V0cy9leHBsb2RlLm1wM1wiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjcmVhdGUoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiY3JlYXRlIGdhbWVcIik7XG4gICAgICAgIHRoaXMuc2NvcmVEaXNwbGF5ID0gdGhpcy5hZGQudGV4dCgyMCwgMjAsIFwiMFwiLCB7IGZvbnRTaXplOiAyMCB9KTtcbiAgICAgICAgdGhpcy5yb2NrZXRfeSA9IHRoaXMuY2FudmFzLmhlaWdodCAqIDAuOTtcbiAgICAgICAgdGhpcy5hbGllbiA9IHRoaXMuYWRkLnNwcml0ZSh0aGlzLmNhbnZhcy53aWR0aCAvIDIsIDEwLCBcImFsaWVuXCIpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBuYW1lID0gYHNoaXAke2l9YDtcbiAgICAgICAgICAgIGxldCBhID0gdGhpcy5hbmltcy5jcmVhdGUoe1xuICAgICAgICAgICAgICAgIGtleTogbmFtZSxcbiAgICAgICAgICAgICAgICBmcmFtZXM6IHRoaXMuYW5pbXMuZ2VuZXJhdGVGcmFtZU51bWJlcnMoXCJhbGllblwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0OiBpICogNCxcbiAgICAgICAgICAgICAgICAgICAgZW5kOiBpICogNCArIDNcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBmcmFtZVJhdGU6IDIsXG4gICAgICAgICAgICAgICAgcmVwZWF0OiAtMVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmFsaWVuLmFuaW1zLmxvYWQobmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hc3Rlcm9pZCA9IHRoaXMuYWRkLnNwcml0ZSgwLCAwLCBcImFzdGVyb2lkXCIpO1xuICAgICAgICBsZXQgYW5pbSA9IHRoaXMuYW5pbXMuY3JlYXRlKHtcbiAgICAgICAgICAgIGtleTogXCJzcGluXCIsXG4gICAgICAgICAgICBmcmFtZXM6IHRoaXMuYW5pbXMuZ2VuZXJhdGVGcmFtZU51bWJlcnMoXCJhc3Rlcm9pZFwiLCB7fSksXG4gICAgICAgICAgICBmcmFtZVJhdGU6IDIwLFxuICAgICAgICAgICAgcmVwZWF0OiAtMVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hc3Rlcm9pZC5hbmltcy5sb2FkKFwic3BpblwiKTtcbiAgICAgICAgdGhpcy5hc3Rlcm9pZC5hbmltcy5wbGF5KFwic3BpblwiKTtcbiAgICAgICAgdGhpcy5yb2NrZXQgPSB0aGlzLmFkZC5zcHJpdGUoKDMgKiB0aGlzLmNhbnZhcy53aWR0aCkgLyA0LCB0aGlzLnJvY2tldF95LCBcInJvY2tldFwiKTtcbiAgICAgICAgdGhpcy5yb2NrZXQuc2V0U2NhbGUoMC41KTtcbiAgICAgICAgdGhpcy5tb3ZlTGVmdCA9IHRoaXMudHdlZW5zLmFkZCh7XG4gICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnJvY2tldCxcbiAgICAgICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgICAgICAgeDogeyB2YWx1ZTogdGhpcy5jYW52YXMud2lkdGggLyA0LCBkdXJhdGlvbjogNTAwIH0sXG4gICAgICAgICAgICAgICAgcm90YXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IC1NYXRoLlBJIC8gMixcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDI1MCxcbiAgICAgICAgICAgICAgICAgICAgeW95bzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVwZWF0OiAwLFxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBcIlNpbmUuZWFzZUluT3V0XCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF1c2VkOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm1vdmVSaWdodCA9IHRoaXMudHdlZW5zLmFkZCh7XG4gICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnJvY2tldCxcbiAgICAgICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgICAgICAgeDogeyB2YWx1ZTogKDMgKiB0aGlzLmNhbnZhcy53aWR0aCkgLyA0LCBkdXJhdGlvbjogNTAwIH0sXG4gICAgICAgICAgICAgICAgcm90YXRpb246IHsgdmFsdWU6IE1hdGguUEkgLyAyLCBkdXJhdGlvbjogMjUwLCB5b3lvOiB0cnVlLCByZXBlYXQ6IDAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhdXNlZDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gRW5hYmxlIHBoeXNpY3Mgb24gcm9ja2V0IGFuZCBhbGllbiBzcHJpdGVzXG4gICAgICAgIHRoaXMucGh5c2ljcy53b3JsZC5lbmFibGUoW3RoaXMucm9ja2V0LCB0aGlzLmFsaWVuLCB0aGlzLmFzdGVyb2lkXSk7XG4gICAgICAgIHRoaXMuY29sbGlkZXIgPSB0aGlzLnBoeXNpY3MuYWRkLm92ZXJsYXAodGhpcy5yb2NrZXQsIFt0aGlzLmFsaWVuLCB0aGlzLmFzdGVyb2lkXSwgdGhpcy5yb2NrZXRDb2xsaWRlV2l0aEFsaWVuLCBudWxsLCB0aGlzKTtcbiAgICAgICAgdGhpcy5wYXJ0aWNsZXMgPSB0aGlzLmFkZC5wYXJ0aWNsZXMoXCJwYXJ0aWNsZVwiKTtcbiAgICAgICAgdGhpcy5lbWl0dGVyID0gdGhpcy5wYXJ0aWNsZXMuY3JlYXRlRW1pdHRlcih7XG4gICAgICAgICAgICBhbmdsZTogeyBtaW46IDAsIG1heDogMzYwIH0sXG4gICAgICAgICAgICBzcGVlZDogeyBtaW46IDUwLCBtYXg6IDIwMCB9LFxuICAgICAgICAgICAgcXVhbnRpdHk6IHsgbWluOiA0MCwgbWF4OiA1MCB9LFxuICAgICAgICAgICAgbGlmZXNwYW46IHsgbWluOiAyMDAsIG1heDogNTAwIH0sXG4gICAgICAgICAgICBhbHBoYTogeyBzdGFydDogMSwgZW5kOiAwIH0sXG4gICAgICAgICAgICBzY2FsZTogeyBtaW46IDAuNSwgbWF4OiAwLjUgfSxcbiAgICAgICAgICAgIHJvdGF0ZTogeyBzdGFydDogMCwgZW5kOiAzNjAgfSxcbiAgICAgICAgICAgIGdyYXZpdHlZOiA4MDAsXG4gICAgICAgICAgICBvbjogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgaWYgKHNldHRpbmdzLnNvdW5kKSB7XG4gICAgICAgICAgICB0aGlzLnBvcFNvdW5kID0gdGhpcy5zb3VuZC5hZGQoXCJwb3BcIik7XG4gICAgICAgICAgICB0aGlzLmFsaWVuU291bmQgPSAodGhpcy5zb3VuZC5hZGQoXCJhbGllblNvdW5kXCIpKTtcbiAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZC5zZXRMb29wKHRydWUpO1xuICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnBsYXkoKTtcbiAgICAgICAgICAgIHRoaXMuZXhwbG9kZVNvdW5kID0gKHRoaXMuc291bmQuYWRkKFwiZXhwbG9kZVNvdW5kXCIpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXNldCgpIHtcbiAgICAgICAgY29uc3QgdyA9IHRoaXMuY2FudmFzLndpZHRoO1xuICAgICAgICB0aGlzLmVsYXBzZWQgPSAwO1xuICAgICAgICB0aGlzLmxhbmUgPSBQaGFzZXIuTWF0aC5CZXR3ZWVuKDAsIDEpO1xuICAgICAgICB0aGlzLnNpZ24gPSAyICogUGhhc2VyLk1hdGguQmV0d2VlbigwLCAxKSAtIDE7XG4gICAgICAgIHRoaXMuZnJlcSA9IDAuNSArIE1hdGgucmFuZG9tKCkgKiAyO1xuICAgICAgICBpZiAodGhpcy5zY29yZSA8IDIwIHx8IE1hdGgucmFuZG9tKCkgPiAwLjIpIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy5hbGllbjtcbiAgICAgICAgICAgIGxldCBuYW1lID0gYHNoaXAke1BoYXNlci5NYXRoLkJldHdlZW4oMCwgOSl9YDtcbiAgICAgICAgICAgIHRoaXMuYWxpZW4uYW5pbXMucGxheShuYW1lKTtcbiAgICAgICAgICAgIHRoaXMuYXN0ZXJvaWQueSA9IC0xMDA7XG4gICAgICAgICAgICBpZiAodGhpcy5hbGllblNvdW5kKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnNldFNlZWsoMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnNldFJhdGUodGhpcy5mcmVxKTtcbiAgICAgICAgICAgICAgICB0aGlzLmFsaWVuU291bmQucGxheSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0aGlzLmFzdGVyb2lkO1xuICAgICAgICAgICAgdGhpcy5hbGllbi55ID0gLTEwMDtcbiAgICAgICAgICAgIGlmICh0aGlzLmFsaWVuU291bmQpXG4gICAgICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRhcmdldC5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICB0aGlzLmNvbGxpZGVyLmFjdGl2ZSA9IHRydWU7XG4gICAgfVxuICAgIHVwZGF0ZSh0aW1lLCBkZWx0YSkge1xuICAgICAgICBjb25zdCB3ID0gdGhpcy5jYW52YXMud2lkdGg7XG4gICAgICAgIGNvbnN0IGggPSB0aGlzLmNhbnZhcy5oZWlnaHQ7XG4gICAgICAgIHRoaXMucHJldmlvdXMgPSB0aGlzLmVsYXBzZWQ7XG4gICAgICAgIHRoaXMuZWxhcHNlZCArPSBkZWx0YSAqIDAuMDAxO1xuICAgICAgICAvLyB1cGRhdGUgd2hlbiB0aGUgcGVyaW9kIGlzIGV4Y2VlZGVkXG4gICAgICAgIGlmICh0aGlzLmVsYXBzZWQgPiB0aGlzLnBlcmlvZCkge1xuICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHBhdXNlIHdoZW4gd2UgcGFzcyB0aGUgZGVjaXNpb24gdGltZVxuICAgICAgICBjb25zdCBkZWNpc2lvbl90aW1lID0gdGhpcy5wZXJpb2QgKiAwLjU7XG4gICAgICAgIGlmICh0aGlzLnByZXZpb3VzIDwgZGVjaXNpb25fdGltZSAmJiB0aGlzLmVsYXBzZWQgPj0gZGVjaXNpb25fdGltZSkge1xuICAgICAgICAgICAgdGhpcy5nZXRVc2VySW5wdXQodGhpcy50YXJnZXQgPT09IHRoaXMuYWxpZW4gPyB0aGlzLmxhbmUgOiAxIC0gdGhpcy5sYW5lLCBcbiAgICAgICAgICAgIC8vICh2OiBudW1iZXIpID0+ICh0aGlzLnJvY2tldF9sYW5lID0gdilcbiAgICAgICAgICAgICh2KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9ja2V0X3ggPSB3IC8gNCArICh2ICogdykgLyAyO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvY2tldC54IDwgcm9ja2V0X3gpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlUmlnaHQucGxheSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLnJvY2tldC54ID4gcm9ja2V0X3gpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlTGVmdC5wbGF5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdSA9IHRoaXMuZWxhcHNlZCAvIHRoaXMucGVyaW9kO1xuICAgICAgICBjb25zdCBnb2FsX3ggPSB3IC8gNCArICh0aGlzLmxhbmUgKiB3KSAvIDI7XG4gICAgICAgIGNvbnN0IHdpZ2dsZSA9IHcgLyAyICtcbiAgICAgICAgICAgICgoTWF0aC5taW4oMTAsIHRoaXMuc2NvcmUpICogdykgLyAyMCkgKlxuICAgICAgICAgICAgICAgICh0aGlzLnNpZ24gKiBNYXRoLnNpbigyICogTWF0aC5QSSAqIHRoaXMuZnJlcSAqIHUpKTtcbiAgICAgICAgY29uc3QgdiA9IE1hdGgubWluKDEsIChoIC8gdGhpcy5yb2NrZXRfeSkgKiB1KTtcbiAgICAgICAgdGhpcy50YXJnZXQueCA9ICgxIC0gdikgKiB3aWdnbGUgKyB2ICogZ29hbF94O1xuICAgICAgICB0aGlzLnRhcmdldC55ID0gdGhpcy5jYW52YXMuaGVpZ2h0ICogdTtcbiAgICAgICAgaWYgKHRoaXMuYWxpZW5Tb3VuZClcbiAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZC5zZXRWb2x1bWUodSk7XG4gICAgICAgIGlmICh1ICUgMC4yIDwgMSAvIDYwKSB7XG4gICAgICAgICAgICAvLyB0aGlzLmFsaWVuLnNldFRpbnQoMHhmZmZmZmYgKiBNYXRoLnJhbmRvbSgpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByb2NrZXRDb2xsaWRlV2l0aEFsaWVuKCkge1xuICAgICAgICAvLyB0aGlzLnNvdW5kLnBsYXkoXCJwb3BcIik7XG4gICAgICAgIGlmICh0aGlzLnRhcmdldCA9PSB0aGlzLmFsaWVuKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wb3BTb3VuZClcbiAgICAgICAgICAgICAgICB0aGlzLnBvcFNvdW5kLnBsYXkoKTtcbiAgICAgICAgICAgIHRoaXMuY2FtZXJhcy5tYWluLmZsYXNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5leHBsb2RlU291bmQpXG4gICAgICAgICAgICAgICAgdGhpcy5leHBsb2RlU291bmQucGxheSgpO1xuICAgICAgICAgICAgdGhpcy5jYW1lcmFzLm1haW4uZmxhc2goNTAwLCAyNTUsIDAsIDApO1xuICAgICAgICB9XG4gICAgICAgIC8vIGZsYXNoXG4gICAgICAgIC8vIEhpZGUgdGhlIGFsaWVuXG4gICAgICAgIHRoaXMudGFyZ2V0LnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgLy8gcHJldmVudCBtdWx0aXBsZSBjb2xsaXNpb25zXG4gICAgICAgIHRoaXMuY29sbGlkZXIuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIC8vIGJsb3d1cFxuICAgICAgICB0aGlzLnBhcnRpY2xlcy5lbWl0UGFydGljbGVBdCh0aGlzLnRhcmdldC54LCB0aGlzLnRhcmdldC55KTtcbiAgICAgICAgLy8gdXBkYXRlIHNjb3JlXG4gICAgICAgIHRoaXMuc2NvcmUgKz0gdGhpcy50YXJnZXQgPT09IHRoaXMuYWxpZW4gPyAxIDogLTE7XG4gICAgICAgIHRoaXMuc2NvcmVEaXNwbGF5LnNldFRleHQoXCJcIiArIHRoaXMuc2NvcmUpO1xuICAgIH1cbn1cbiIsImltcG9ydCBcInBoYXNlclwiO1xuaW1wb3J0IHsgQ29udHJvbFNjZW5lIH0gZnJvbSBcIi4vYmFzZVwiO1xuaW1wb3J0IHsgR2FtZVNjZW5lIH0gZnJvbSBcIi4vZ2FtZVwiO1xuaW1wb3J0IHNldHRpbmdzIGZyb20gXCIuL3NldHRpbmdzXCI7XG5jb25zdCBjb25maWcgPSB7XG4gICAgdGl0bGU6IFwiU3BhY2VcIixcbiAgICB0eXBlOiBQaGFzZXIuQVVUTyxcbiAgICB3aWR0aDogNjAwLFxuICAgIGhlaWdodDogODAwLFxuICAgIHNjYWxlOiB7XG4gICAgICAgIG1vZGU6IFBoYXNlci5TY2FsZS5SRVNJWkUsXG4gICAgICAgIGF1dG9DZW50ZXI6IFBoYXNlci5TY2FsZS5DRU5URVJfQk9USFxuICAgIH0sXG4gICAgcGFyZW50OiBcImdhbWVcIixcbiAgICBzY2VuZTogW0dhbWVTY2VuZSwgQ29udHJvbFNjZW5lXSxcbiAgICBwaHlzaWNzOiB7XG4gICAgICAgIGRlZmF1bHQ6IFwiYXJjYWRlXCIsXG4gICAgICAgIGFyY2FkZToge1xuICAgICAgICAgICAgZGVidWc6IGZhbHNlXG4gICAgICAgIH1cbiAgICB9LFxuICAgIGJhY2tncm91bmRDb2xvcjogXCIjNDQ0NDQ0XCJcbn07XG5leHBvcnQgY2xhc3MgTXlHYW1lIGV4dGVuZHMgUGhhc2VyLkdhbWUge1xuICAgIGNvbnN0cnVjdG9yKGNvbmZpZykge1xuICAgICAgICBzdXBlcihjb25maWcpO1xuICAgIH1cbn1cbndpbmRvdy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgbGV0IGdhbWUgPSBudWxsO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2V0dXBcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgaWYgKGdhbWUpIHtcbiAgICAgICAgICAgIGdhbWUuZGVzdHJveSh0cnVlKTtcbiAgICAgICAgICAgIGdhbWUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnZhbHVlID0gXCJzZXR0aW5nc1wiO1xuICAgIH0pO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheUJ1dHRvblwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC52YWx1ZSA9IFwicGxheVwiO1xuICAgICAgICBnYW1lID0gbmV3IE15R2FtZShjb25maWcpO1xuICAgIH0pO1xuICAgIFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXRbbmFtZT1tb2RlXVwiKV0ubWFwKChub2RlKSA9PiAobm9kZS5jaGVja2VkID0gbm9kZS52YWx1ZSA9PSBzZXR0aW5ncy5tb2RlKSk7XG4gICAgY29uc3Qgc291bmRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic291bmRcIik7XG4gICAgc291bmRJbnB1dC5jaGVja2VkID0gc2V0dGluZ3Muc291bmQ7XG4gICAgY29uc3QgYXN0ZXJvaWRzSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFzdGVyb2lkc1wiKTtcbiAgICBhc3Rlcm9pZHNJbnB1dC5jaGVja2VkID0gc2V0dGluZ3MuYXN0ZXJvaWRzO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2V0dGluZ3NcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBlID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjaGFuZ2VcIik7XG4gICAgICAgIGNvbnN0IG1vZGVJbnB1dCA9IChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZT1tb2RlXTpjaGVja2VkXCIpKTtcbiAgICAgICAgY29uc3QgbW9kZSA9IG1vZGVJbnB1dC52YWx1ZTtcbiAgICAgICAgc2V0dGluZ3MubW9kZSA9IG1vZGU7XG4gICAgICAgIGNvbnN0IHNvdW5kSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvdW5kXCIpO1xuICAgICAgICBzZXR0aW5ncy5zb3VuZCA9IHNvdW5kSW5wdXQuY2hlY2tlZDtcbiAgICAgICAgY29uc3QgYXN0ZXJvaWRzSW5wdXQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhc3Rlcm9pZHNcIikpO1xuICAgICAgICBzZXR0aW5ncy5hc3Rlcm9pZHMgPSBhc3Rlcm9pZHNJbnB1dC5jaGVja2VkO1xuICAgICAgICBzZXR0aW5ncy5wZXJzaXN0KCk7XG4gICAgfSk7XG59O1xuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///1\n')}]);