!function(I){var g={};function C(A){if(g[A])return g[A].exports;var t=g[A]={i:A,l:!1,exports:{}};return I[A].call(t.exports,t,t.exports,C),t.l=!0,t.exports}C.m=I,C.c=g,C.d=function(I,g,A){C.o(I,g)||Object.defineProperty(I,g,{enumerable:!0,get:A})},C.r=function(I){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})},C.t=function(I,g){if(1&g&&(I=C(I)),8&g)return I;if(4&g&&"object"==typeof I&&I&&I.__esModule)return I;var A=Object.create(null);if(C.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:I}),2&g&&"string"!=typeof I)for(var t in I)C.d(A,t,function(g){return I[g]}.bind(null,t));return A},C.n=function(I){var g=I&&I.__esModule?function(){return I.default}:function(){return I};return C.d(g,"a",g),g},C.o=function(I,g){return Object.prototype.hasOwnProperty.call(I,g)},C.p="",C(C.s=1)}([function(module,exports){eval("module.exports = Phaser;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJQaGFzZXJcIj9lYmM2Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IFBoYXNlcjsiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: external "Phaser"\nvar external_Phaser_ = __webpack_require__(0);\n\n// CONCATENATED MODULE: ./src/settings.ts\nconst key = "space-config";\nconst version = 2;\nclass Settings {\n    constructor() {\n        this.mode = "auto";\n        this.sound = true;\n        this.asteroids = true;\n    }\n    persist() {\n        const data = {\n            version: version,\n            mode: this.mode,\n            sound: this.sound,\n            asteroids: this.asteroids\n        };\n        const json = JSON.stringify(data);\n        localStorage.setItem(key, json);\n    }\n    restore() {\n        const json = localStorage.getItem(key);\n        if (json) {\n            const data = JSON.parse(json);\n            if (data.version == version) {\n                this.mode = data.mode;\n                this.sound = data.sound;\n                this.asteroids = data.asteroids;\n            }\n        }\n    }\n}\nconst settings = new Settings();\nsettings.restore();\n/* harmony default export */ var src_settings = (settings);\n\n// CONCATENATED MODULE: ./src/base.ts\n\n\nclass base_SwitchBase extends Phaser.Scene {\n    constructor(args) {\n        super(args);\n        this.waiting = false;\n    }\n    getUserInput(correct, func) {\n        this.waiting = true;\n        this.correct = correct;\n        this.callback = func;\n        if (src_settings.mode == "auto") {\n            this.time.delayedCall(1000, () => {\n                this.returnInput(this.correct);\n            }, [], this);\n        }\n    }\n    returnInput(value) {\n        if (!this.waiting) {\n            return;\n        }\n        this.setSelected(value);\n        if (src_settings.mode == "one") {\n            value = this.correct;\n        }\n        this.callback(value);\n        this.waiting = false;\n    }\n    setSelected(choice) {\n        const choices = document.querySelectorAll("button.choice");\n        let selected = document.querySelector("button.selected");\n        if (selected) {\n            selected.classList.remove("selected");\n        }\n        choices[choice].classList.add("selected");\n    }\n    create() {\n        console.log("create control");\n        this.input.keyboard.on("keydown-LEFT", (e) => {\n            // pass response back to caller\n            this.returnInput(0);\n        });\n        this.input.keyboard.on("keydown-RIGHT", (e) => {\n            // pass response back to caller\n            this.returnInput(1);\n        });\n        document\n            .getElementById("left")\n            .addEventListener("click", e => this.returnInput(0));\n        document\n            .getElementById("right")\n            .addEventListener("click", e => this.returnInput(1));\n        this.input.keyboard.on("keydown-SPACE", (e) => {\n            const choices = document.querySelectorAll("button.choice");\n            let selected = document.querySelector("button.selected");\n            let i = 0;\n            if (selected) {\n                i = ([...choices].indexOf(selected) + 1) % choices.length;\n                selected.classList.remove("selected");\n            }\n            choices[i].classList.add("selected");\n        });\n        this.input.keyboard.on("keydown-ENTER", (e) => {\n            const selected = (document.querySelector("button.selected"));\n            if (selected) {\n                selected.click();\n            }\n        });\n    }\n}\n\n// CONCATENATED MODULE: ./src/game.ts\n\n\n\nclass game_GameScene extends base_SwitchBase {\n    constructor() {\n        super({\n            key: "GameScene"\n        });\n        this.period = 2000; // time per cycle\n        this.canvas = document.querySelector("canvas");\n        this.rocket_y = 0;\n        this.score = 0;\n        this.popSound = null;\n        this.alienSound = null;\n        this.explodeSound = null;\n    }\n    preload() {\n        // this.load.image("alien", "assets/alien.png");\n        this.load.spritesheet("alien", "assets/alien-sheet.png", {\n            frameWidth: 73,\n            frameHeight: 44,\n            startFrame: 0,\n            endFrame: 39\n        });\n        this.load.spritesheet("asteroid", "assets/asteroid-sheet.png", {\n            frameWidth: 120,\n            frameHeight: 120,\n            startFrame: 0,\n            endFrame: 15\n        });\n        this.load.image("rocket", "assets/rocket.png");\n        this.load.image("particle", "assets/particle.png");\n        if (src_settings.sound) {\n            this.load.audio("pop", "assets/success.mp3");\n            this.load.audio("alienSound", "assets/alien.mp3");\n            this.load.audio("explodeSound", "assets/explode.mp3");\n        }\n    }\n    create() {\n        super.create();\n        console.log("create game");\n        this.scoreDisplay = this.add.text(20, 20, "0", { fontSize: 20 });\n        this.rocket_y = this.canvas.height * 0.9;\n        this.alien = this.add.sprite(this.canvas.width / 2, 10, "alien");\n        for (let i = 0; i < 10; i++) {\n            let name = `ship${i}`;\n            let a = this.anims.create({\n                key: name,\n                frames: this.anims.generateFrameNumbers("alien", {\n                    start: i * 4,\n                    end: i * 4 + 3\n                }),\n                frameRate: 10,\n                repeat: -1\n            });\n            this.alien.anims.load(name);\n        }\n        this.asteroid = this.add.sprite(0, 0, "asteroid");\n        let anim = this.anims.create({\n            key: "spin",\n            frames: this.anims.generateFrameNumbers("asteroid", {}),\n            frameRate: 20,\n            repeat: -1\n        });\n        this.asteroid.anims.load("spin");\n        this.asteroid.anims.play("spin");\n        this.rocket = this.add.sprite((3 * this.canvas.width) / 4, this.rocket_y, "rocket");\n        this.rocket.setScale(0.5);\n        // Enable physics on rocket and alien sprites\n        this.physics.world.enable([this.rocket, this.alien, this.asteroid]);\n        this.collider = this.physics.add.overlap(this.rocket, [this.alien, this.asteroid], this.rocketCollideWithAlien, null, this);\n        this.particles = this.add.particles("particle");\n        this.emitter = this.particles.createEmitter({\n            angle: { min: 0, max: 360 },\n            speed: { min: 50, max: 200 },\n            quantity: { min: 40, max: 50 },\n            lifespan: { min: 200, max: 500 },\n            alpha: { start: 1, end: 0 },\n            scale: { min: 0.5, max: 0.5 },\n            rotate: { start: 0, end: 360 },\n            gravityY: 800,\n            on: false\n        });\n        this.reset();\n        if (src_settings.sound) {\n            this.popSound = this.sound.add("pop");\n            this.alienSound = (this.sound.add("alienSound"));\n            this.alienSound.setLoop(true);\n            this.alienSound.play();\n            this.explodeSound = (this.sound.add("explodeSound"));\n        }\n        const starPeriod = 4 * this.period;\n        for (let s = 0; s < 100; s++) {\n            let star = this.add.graphics();\n            star.fillStyle(0xffffff);\n            star.fillPoint(Phaser.Math.Between(0, this.canvas.width), 0, 2);\n            this.tweens.add({\n                targets: star,\n                duration: starPeriod,\n                delay: Phaser.Math.Between(0, starPeriod),\n                repeat: -1,\n                repeatDelay: Phaser.Math.Between(100, 500),\n                y: this.canvas.height,\n                onRepeat: () => {\n                    star.x = Phaser.Math.Between(0, this.canvas.width);\n                }\n            });\n        }\n    }\n    reset() {\n        const w = this.canvas.width;\n        const lane = Phaser.Math.Between(0, 1);\n        const sign = 2 * Phaser.Math.Between(0, 1) - 1;\n        const freq = 0.5 + Math.random() * 2;\n        if (this.score < 20 || Math.random() > 0.2) {\n            this.target = this.alien;\n            const name = `ship${Phaser.Math.Between(0, 9)}`;\n            this.alien.anims.play(name);\n            this.asteroid.y = -100;\n            if (this.alienSound) {\n                this.alienSound.setSeek(0);\n                this.alienSound.setRate(freq);\n                this.alienSound.play();\n            }\n        }\n        else {\n            this.target = this.asteroid;\n            this.alien.y = -100;\n            if (this.alienSound)\n                this.alienSound.stop();\n        }\n        this.target.y = 0;\n        this.attack = this.tweens.add({\n            key: "attack",\n            targets: this.target,\n            y: this.canvas.height,\n            onUpdate: (tween, target) => {\n                const u = target.y / this.canvas.height;\n                const goal_x = w * (1 / 4 + lane / 2);\n                const wiggle = w *\n                    (1 / 2 +\n                        (Math.min(10, this.score) / 20) *\n                            (sign * Math.sin(2 * Math.PI * freq * u)));\n                const v = Math.min(1, target.y / this.rocket_y);\n                target.x = (1 - v) * wiggle + v * goal_x;\n                if (this.alienSound)\n                    this.alienSound.setVolume(u);\n            },\n            onComplete: () => this.reset(),\n            duration: this.period\n        });\n        this.target.setVisible(true);\n        this.collider.active = true;\n        this.time.delayedCall(this.period / 2, () => {\n            this.attack.pause();\n            this.getUserInput(this.target === this.alien ? lane : 1 - lane, (v) => {\n                this.attack.resume();\n                const rocket_x = w * (1 / 4 + v / 2);\n                if (this.rocket.x < rocket_x) {\n                    this.tweens.add({\n                        targets: this.rocket,\n                        props: {\n                            x: { value: (3 * w) / 4, duration: 500 },\n                            rotation: { value: Math.PI / 2, duration: 250, yoyo: true }\n                        }\n                    });\n                }\n                else if (this.rocket.x > rocket_x) {\n                    this.tweens.add({\n                        targets: this.rocket,\n                        props: {\n                            x: { value: w / 4, duration: 500 },\n                            rotation: {\n                                value: -Math.PI / 2,\n                                duration: 250,\n                                yoyo: true\n                            }\n                        }\n                    });\n                }\n            });\n        }, [], this);\n    }\n    rocketCollideWithAlien() {\n        if (this.target == this.alien) {\n            if (this.popSound)\n                this.popSound.play();\n            this.cameras.main.flash();\n            this.score += 1;\n        }\n        else {\n            if (this.explodeSound)\n                this.explodeSound.play();\n            this.cameras.main.flash(500, 255, 0, 0);\n            this.score -= 1;\n        }\n        // Hide the target\n        this.target.visible = false;\n        // prevent multiple collisions\n        this.collider.active = false;\n        // blowup\n        this.particles.emitParticleAt(this.target.x, this.target.y);\n        // display score\n        this.scoreDisplay.setText("" + this.score);\n    }\n}\n\n// CONCATENATED MODULE: ./src/app.ts\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MyGame", function() { return MyGame; });\n\n\n\nconst config = {\n    title: "Space",\n    type: Phaser.AUTO,\n    width: 600,\n    height: 800,\n    scale: {\n        mode: Phaser.Scale.RESIZE,\n        autoCenter: Phaser.Scale.CENTER_BOTH\n    },\n    parent: "game",\n    scene: [game_GameScene],\n    physics: {\n        default: "arcade",\n        arcade: {\n            debug: false\n        }\n    },\n    backgroundColor: "#101010"\n};\nclass MyGame extends Phaser.Game {\n    constructor(config) {\n        super(config);\n    }\n}\nwindow.onload = () => {\n    let game = null;\n    document.getElementById("setup").addEventListener("click", () => {\n        if (game) {\n            game.destroy(true);\n            game = null;\n        }\n        document.body.classList.value = "settings";\n    });\n    document.getElementById("playButton").addEventListener("click", () => {\n        document.body.classList.value = "play";\n        game = new MyGame(config);\n    });\n    [...document.querySelectorAll("input[name=mode]")].map((node) => (node.checked = node.value == src_settings.mode));\n    const soundInput = document.getElementById("sound");\n    soundInput.checked = src_settings.sound;\n    const asteroidsInput = document.getElementById("asteroids");\n    asteroidsInput.checked = src_settings.asteroids;\n    document.getElementById("settings").addEventListener("change", e => {\n        console.log("change");\n        const modeInput = (document.querySelector("input[name=mode]:checked"));\n        const mode = modeInput.value;\n        src_settings.mode = mode;\n        const soundInput = document.getElementById("sound");\n        src_settings.sound = soundInput.checked;\n        const asteroidsInput = (document.getElementById("asteroids"));\n        src_settings.asteroids = asteroidsInput.checked;\n        src_settings.persist();\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvc2V0dGluZ3MudHM/YzIzYyIsIndlYnBhY2s6Ly8vLi9zcmMvYmFzZS50cz9hZTgzIiwid2VicGFjazovLy8uL3NyYy9nYW1lLnRzP2FhZmMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FwcC50cz9mMWIyIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDZSx5REFBUSxFQUFDOzs7QUNoQ1I7QUFDa0I7QUFDM0IsTUFBTSxlQUFVO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFlBQVE7QUFDcEI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksWUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7OztBQ3JFZ0I7QUFDb0I7QUFDRjtBQUMzQixNQUFNLGNBQVMsU0FBUyxlQUFVO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxZQUFZLFlBQVE7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RCxlQUFlO0FBQ3ZFO0FBQ0E7QUFDQSx1QkFBdUIsUUFBUTtBQUMvQiw4QkFBOEIsRUFBRTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRTtBQUNsRTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixtQkFBbUI7QUFDdkMsb0JBQW9CLG9CQUFvQjtBQUN4Qyx1QkFBdUIsbUJBQW1CO0FBQzFDLHVCQUF1QixxQkFBcUI7QUFDNUMsb0JBQW9CLG1CQUFtQjtBQUN2QyxvQkFBb0IscUJBQXFCO0FBQ3pDLHFCQUFxQixxQkFBcUI7QUFDMUM7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFlBQVksWUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixTQUFTO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQywwQkFBMEI7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxvQ0FBb0M7QUFDcEUsdUNBQXVDO0FBQ3ZDO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsOEJBQThCO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUM3TUE7QUFBZ0I7QUFDbUI7QUFDRDtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsWUFBWSxjQUFTO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxtR0FBbUcsWUFBUTtBQUMzRztBQUNBLHlCQUF5QixZQUFRO0FBQ2pDO0FBQ0EsNkJBQTZCLFlBQVE7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLFlBQVE7QUFDaEI7QUFDQSxRQUFRLFlBQVE7QUFDaEI7QUFDQSxRQUFRLFlBQVE7QUFDaEIsUUFBUSxZQUFRO0FBQ2hCLEtBQUs7QUFDTCIsImZpbGUiOiIxLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qga2V5ID0gXCJzcGFjZS1jb25maWdcIjtcbmNvbnN0IHZlcnNpb24gPSAyO1xuY2xhc3MgU2V0dGluZ3Mge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLm1vZGUgPSBcImF1dG9cIjtcbiAgICAgICAgdGhpcy5zb3VuZCA9IHRydWU7XG4gICAgICAgIHRoaXMuYXN0ZXJvaWRzID0gdHJ1ZTtcbiAgICB9XG4gICAgcGVyc2lzdCgpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHtcbiAgICAgICAgICAgIHZlcnNpb246IHZlcnNpb24sXG4gICAgICAgICAgICBtb2RlOiB0aGlzLm1vZGUsXG4gICAgICAgICAgICBzb3VuZDogdGhpcy5zb3VuZCxcbiAgICAgICAgICAgIGFzdGVyb2lkczogdGhpcy5hc3Rlcm9pZHNcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QganNvbiA9IEpTT04uc3RyaW5naWZ5KGRhdGEpO1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIGpzb24pO1xuICAgIH1cbiAgICByZXN0b3JlKCkge1xuICAgICAgICBjb25zdCBqc29uID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgICAgICAgaWYgKGpzb24pIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKGpzb24pO1xuICAgICAgICAgICAgaWYgKGRhdGEudmVyc2lvbiA9PSB2ZXJzaW9uKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RlID0gZGF0YS5tb2RlO1xuICAgICAgICAgICAgICAgIHRoaXMuc291bmQgPSBkYXRhLnNvdW5kO1xuICAgICAgICAgICAgICAgIHRoaXMuYXN0ZXJvaWRzID0gZGF0YS5hc3Rlcm9pZHM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5jb25zdCBzZXR0aW5ncyA9IG5ldyBTZXR0aW5ncygpO1xuc2V0dGluZ3MucmVzdG9yZSgpO1xuZXhwb3J0IGRlZmF1bHQgc2V0dGluZ3M7XG4iLCJpbXBvcnQgXCJwaGFzZXJcIjtcbmltcG9ydCBzZXR0aW5ncyBmcm9tIFwiLi9zZXR0aW5nc1wiO1xuZXhwb3J0IGNsYXNzIFN3aXRjaEJhc2UgZXh0ZW5kcyBQaGFzZXIuU2NlbmUge1xuICAgIGNvbnN0cnVjdG9yKGFyZ3MpIHtcbiAgICAgICAgc3VwZXIoYXJncyk7XG4gICAgICAgIHRoaXMud2FpdGluZyA9IGZhbHNlO1xuICAgIH1cbiAgICBnZXRVc2VySW5wdXQoY29ycmVjdCwgZnVuYykge1xuICAgICAgICB0aGlzLndhaXRpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmNvcnJlY3QgPSBjb3JyZWN0O1xuICAgICAgICB0aGlzLmNhbGxiYWNrID0gZnVuYztcbiAgICAgICAgaWYgKHNldHRpbmdzLm1vZGUgPT0gXCJhdXRvXCIpIHtcbiAgICAgICAgICAgIHRoaXMudGltZS5kZWxheWVkQ2FsbCgxMDAwLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXR1cm5JbnB1dCh0aGlzLmNvcnJlY3QpO1xuICAgICAgICAgICAgfSwgW10sIHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybklucHV0KHZhbHVlKSB7XG4gICAgICAgIGlmICghdGhpcy53YWl0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRTZWxlY3RlZCh2YWx1ZSk7XG4gICAgICAgIGlmIChzZXR0aW5ncy5tb2RlID09IFwib25lXCIpIHtcbiAgICAgICAgICAgIHZhbHVlID0gdGhpcy5jb3JyZWN0O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2FsbGJhY2sodmFsdWUpO1xuICAgICAgICB0aGlzLndhaXRpbmcgPSBmYWxzZTtcbiAgICB9XG4gICAgc2V0U2VsZWN0ZWQoY2hvaWNlKSB7XG4gICAgICAgIGNvbnN0IGNob2ljZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiYnV0dG9uLmNob2ljZVwiKTtcbiAgICAgICAgbGV0IHNlbGVjdGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJ1dHRvbi5zZWxlY3RlZFwiKTtcbiAgICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgICAgICBzZWxlY3RlZC5jbGFzc0xpc3QucmVtb3ZlKFwic2VsZWN0ZWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgY2hvaWNlc1tjaG9pY2VdLmNsYXNzTGlzdC5hZGQoXCJzZWxlY3RlZFwiKTtcbiAgICB9XG4gICAgY3JlYXRlKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImNyZWF0ZSBjb250cm9sXCIpO1xuICAgICAgICB0aGlzLmlucHV0LmtleWJvYXJkLm9uKFwia2V5ZG93bi1MRUZUXCIsIChlKSA9PiB7XG4gICAgICAgICAgICAvLyBwYXNzIHJlc3BvbnNlIGJhY2sgdG8gY2FsbGVyXG4gICAgICAgICAgICB0aGlzLnJldHVybklucHV0KDApO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pbnB1dC5rZXlib2FyZC5vbihcImtleWRvd24tUklHSFRcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIC8vIHBhc3MgcmVzcG9uc2UgYmFjayB0byBjYWxsZXJcbiAgICAgICAgICAgIHRoaXMucmV0dXJuSW5wdXQoMSk7XG4gICAgICAgIH0pO1xuICAgICAgICBkb2N1bWVudFxuICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKFwibGVmdFwiKVxuICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHRoaXMucmV0dXJuSW5wdXQoMCkpO1xuICAgICAgICBkb2N1bWVudFxuICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKFwicmlnaHRcIilcbiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB0aGlzLnJldHVybklucHV0KDEpKTtcbiAgICAgICAgdGhpcy5pbnB1dC5rZXlib2FyZC5vbihcImtleWRvd24tU1BBQ0VcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNob2ljZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiYnV0dG9uLmNob2ljZVwiKTtcbiAgICAgICAgICAgIGxldCBzZWxlY3RlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24uc2VsZWN0ZWRcIik7XG4gICAgICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBpID0gKFsuLi5jaG9pY2VzXS5pbmRleE9mKHNlbGVjdGVkKSArIDEpICUgY2hvaWNlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2hvaWNlc1tpXS5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmlucHV0LmtleWJvYXJkLm9uKFwia2V5ZG93bi1FTlRFUlwiLCAoZSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJ1dHRvbi5zZWxlY3RlZFwiKSk7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZC5jbGljaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCJpbXBvcnQgXCJwaGFzZXJcIjtcbmltcG9ydCB7IFN3aXRjaEJhc2UgfSBmcm9tIFwiLi9iYXNlXCI7XG5pbXBvcnQgc2V0dGluZ3MgZnJvbSBcIi4vc2V0dGluZ3NcIjtcbmV4cG9ydCBjbGFzcyBHYW1lU2NlbmUgZXh0ZW5kcyBTd2l0Y2hCYXNlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoe1xuICAgICAgICAgICAga2V5OiBcIkdhbWVTY2VuZVwiXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBlcmlvZCA9IDIwMDA7IC8vIHRpbWUgcGVyIGN5Y2xlXG4gICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImNhbnZhc1wiKTtcbiAgICAgICAgdGhpcy5yb2NrZXRfeSA9IDA7XG4gICAgICAgIHRoaXMuc2NvcmUgPSAwO1xuICAgICAgICB0aGlzLnBvcFNvdW5kID0gbnVsbDtcbiAgICAgICAgdGhpcy5hbGllblNvdW5kID0gbnVsbDtcbiAgICAgICAgdGhpcy5leHBsb2RlU291bmQgPSBudWxsO1xuICAgIH1cbiAgICBwcmVsb2FkKCkge1xuICAgICAgICAvLyB0aGlzLmxvYWQuaW1hZ2UoXCJhbGllblwiLCBcImFzc2V0cy9hbGllbi5wbmdcIik7XG4gICAgICAgIHRoaXMubG9hZC5zcHJpdGVzaGVldChcImFsaWVuXCIsIFwiYXNzZXRzL2FsaWVuLXNoZWV0LnBuZ1wiLCB7XG4gICAgICAgICAgICBmcmFtZVdpZHRoOiA3MyxcbiAgICAgICAgICAgIGZyYW1lSGVpZ2h0OiA0NCxcbiAgICAgICAgICAgIHN0YXJ0RnJhbWU6IDAsXG4gICAgICAgICAgICBlbmRGcmFtZTogMzlcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubG9hZC5zcHJpdGVzaGVldChcImFzdGVyb2lkXCIsIFwiYXNzZXRzL2FzdGVyb2lkLXNoZWV0LnBuZ1wiLCB7XG4gICAgICAgICAgICBmcmFtZVdpZHRoOiAxMjAsXG4gICAgICAgICAgICBmcmFtZUhlaWdodDogMTIwLFxuICAgICAgICAgICAgc3RhcnRGcmFtZTogMCxcbiAgICAgICAgICAgIGVuZEZyYW1lOiAxNVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwicm9ja2V0XCIsIFwiYXNzZXRzL3JvY2tldC5wbmdcIik7XG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInBhcnRpY2xlXCIsIFwiYXNzZXRzL3BhcnRpY2xlLnBuZ1wiKTtcbiAgICAgICAgaWYgKHNldHRpbmdzLnNvdW5kKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWQuYXVkaW8oXCJwb3BcIiwgXCJhc3NldHMvc3VjY2Vzcy5tcDNcIik7XG4gICAgICAgICAgICB0aGlzLmxvYWQuYXVkaW8oXCJhbGllblNvdW5kXCIsIFwiYXNzZXRzL2FsaWVuLm1wM1wiKTtcbiAgICAgICAgICAgIHRoaXMubG9hZC5hdWRpbyhcImV4cGxvZGVTb3VuZFwiLCBcImFzc2V0cy9leHBsb2RlLm1wM1wiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjcmVhdGUoKSB7XG4gICAgICAgIHN1cGVyLmNyZWF0ZSgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcImNyZWF0ZSBnYW1lXCIpO1xuICAgICAgICB0aGlzLnNjb3JlRGlzcGxheSA9IHRoaXMuYWRkLnRleHQoMjAsIDIwLCBcIjBcIiwgeyBmb250U2l6ZTogMjAgfSk7XG4gICAgICAgIHRoaXMucm9ja2V0X3kgPSB0aGlzLmNhbnZhcy5oZWlnaHQgKiAwLjk7XG4gICAgICAgIHRoaXMuYWxpZW4gPSB0aGlzLmFkZC5zcHJpdGUodGhpcy5jYW52YXMud2lkdGggLyAyLCAxMCwgXCJhbGllblwiKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgbmFtZSA9IGBzaGlwJHtpfWA7XG4gICAgICAgICAgICBsZXQgYSA9IHRoaXMuYW5pbXMuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICBrZXk6IG5hbWUsXG4gICAgICAgICAgICAgICAgZnJhbWVzOiB0aGlzLmFuaW1zLmdlbmVyYXRlRnJhbWVOdW1iZXJzKFwiYWxpZW5cIiwge1xuICAgICAgICAgICAgICAgICAgICBzdGFydDogaSAqIDQsXG4gICAgICAgICAgICAgICAgICAgIGVuZDogaSAqIDQgKyAzXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgZnJhbWVSYXRlOiAxMCxcbiAgICAgICAgICAgICAgICByZXBlYXQ6IC0xXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuYWxpZW4uYW5pbXMubG9hZChuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFzdGVyb2lkID0gdGhpcy5hZGQuc3ByaXRlKDAsIDAsIFwiYXN0ZXJvaWRcIik7XG4gICAgICAgIGxldCBhbmltID0gdGhpcy5hbmltcy5jcmVhdGUoe1xuICAgICAgICAgICAga2V5OiBcInNwaW5cIixcbiAgICAgICAgICAgIGZyYW1lczogdGhpcy5hbmltcy5nZW5lcmF0ZUZyYW1lTnVtYmVycyhcImFzdGVyb2lkXCIsIHt9KSxcbiAgICAgICAgICAgIGZyYW1lUmF0ZTogMjAsXG4gICAgICAgICAgICByZXBlYXQ6IC0xXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmFzdGVyb2lkLmFuaW1zLmxvYWQoXCJzcGluXCIpO1xuICAgICAgICB0aGlzLmFzdGVyb2lkLmFuaW1zLnBsYXkoXCJzcGluXCIpO1xuICAgICAgICB0aGlzLnJvY2tldCA9IHRoaXMuYWRkLnNwcml0ZSgoMyAqIHRoaXMuY2FudmFzLndpZHRoKSAvIDQsIHRoaXMucm9ja2V0X3ksIFwicm9ja2V0XCIpO1xuICAgICAgICB0aGlzLnJvY2tldC5zZXRTY2FsZSgwLjUpO1xuICAgICAgICAvLyBFbmFibGUgcGh5c2ljcyBvbiByb2NrZXQgYW5kIGFsaWVuIHNwcml0ZXNcbiAgICAgICAgdGhpcy5waHlzaWNzLndvcmxkLmVuYWJsZShbdGhpcy5yb2NrZXQsIHRoaXMuYWxpZW4sIHRoaXMuYXN0ZXJvaWRdKTtcbiAgICAgICAgdGhpcy5jb2xsaWRlciA9IHRoaXMucGh5c2ljcy5hZGQub3ZlcmxhcCh0aGlzLnJvY2tldCwgW3RoaXMuYWxpZW4sIHRoaXMuYXN0ZXJvaWRdLCB0aGlzLnJvY2tldENvbGxpZGVXaXRoQWxpZW4sIG51bGwsIHRoaXMpO1xuICAgICAgICB0aGlzLnBhcnRpY2xlcyA9IHRoaXMuYWRkLnBhcnRpY2xlcyhcInBhcnRpY2xlXCIpO1xuICAgICAgICB0aGlzLmVtaXR0ZXIgPSB0aGlzLnBhcnRpY2xlcy5jcmVhdGVFbWl0dGVyKHtcbiAgICAgICAgICAgIGFuZ2xlOiB7IG1pbjogMCwgbWF4OiAzNjAgfSxcbiAgICAgICAgICAgIHNwZWVkOiB7IG1pbjogNTAsIG1heDogMjAwIH0sXG4gICAgICAgICAgICBxdWFudGl0eTogeyBtaW46IDQwLCBtYXg6IDUwIH0sXG4gICAgICAgICAgICBsaWZlc3BhbjogeyBtaW46IDIwMCwgbWF4OiA1MDAgfSxcbiAgICAgICAgICAgIGFscGhhOiB7IHN0YXJ0OiAxLCBlbmQ6IDAgfSxcbiAgICAgICAgICAgIHNjYWxlOiB7IG1pbjogMC41LCBtYXg6IDAuNSB9LFxuICAgICAgICAgICAgcm90YXRlOiB7IHN0YXJ0OiAwLCBlbmQ6IDM2MCB9LFxuICAgICAgICAgICAgZ3Jhdml0eVk6IDgwMCxcbiAgICAgICAgICAgIG9uOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICBpZiAoc2V0dGluZ3Muc291bmQpIHtcbiAgICAgICAgICAgIHRoaXMucG9wU291bmQgPSB0aGlzLnNvdW5kLmFkZChcInBvcFwiKTtcbiAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZCA9ICh0aGlzLnNvdW5kLmFkZChcImFsaWVuU291bmRcIikpO1xuICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnNldExvb3AodHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmFsaWVuU291bmQucGxheSgpO1xuICAgICAgICAgICAgdGhpcy5leHBsb2RlU291bmQgPSAodGhpcy5zb3VuZC5hZGQoXCJleHBsb2RlU291bmRcIikpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0YXJQZXJpb2QgPSA0ICogdGhpcy5wZXJpb2Q7XG4gICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgMTAwOyBzKyspIHtcbiAgICAgICAgICAgIGxldCBzdGFyID0gdGhpcy5hZGQuZ3JhcGhpY3MoKTtcbiAgICAgICAgICAgIHN0YXIuZmlsbFN0eWxlKDB4ZmZmZmZmKTtcbiAgICAgICAgICAgIHN0YXIuZmlsbFBvaW50KFBoYXNlci5NYXRoLkJldHdlZW4oMCwgdGhpcy5jYW52YXMud2lkdGgpLCAwLCAyKTtcbiAgICAgICAgICAgIHRoaXMudHdlZW5zLmFkZCh7XG4gICAgICAgICAgICAgICAgdGFyZ2V0czogc3RhcixcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogc3RhclBlcmlvZCxcbiAgICAgICAgICAgICAgICBkZWxheTogUGhhc2VyLk1hdGguQmV0d2VlbigwLCBzdGFyUGVyaW9kKSxcbiAgICAgICAgICAgICAgICByZXBlYXQ6IC0xLFxuICAgICAgICAgICAgICAgIHJlcGVhdERlbGF5OiBQaGFzZXIuTWF0aC5CZXR3ZWVuKDEwMCwgNTAwKSxcbiAgICAgICAgICAgICAgICB5OiB0aGlzLmNhbnZhcy5oZWlnaHQsXG4gICAgICAgICAgICAgICAgb25SZXBlYXQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3Rhci54ID0gUGhhc2VyLk1hdGguQmV0d2VlbigwLCB0aGlzLmNhbnZhcy53aWR0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVzZXQoKSB7XG4gICAgICAgIGNvbnN0IHcgPSB0aGlzLmNhbnZhcy53aWR0aDtcbiAgICAgICAgY29uc3QgbGFuZSA9IFBoYXNlci5NYXRoLkJldHdlZW4oMCwgMSk7XG4gICAgICAgIGNvbnN0IHNpZ24gPSAyICogUGhhc2VyLk1hdGguQmV0d2VlbigwLCAxKSAtIDE7XG4gICAgICAgIGNvbnN0IGZyZXEgPSAwLjUgKyBNYXRoLnJhbmRvbSgpICogMjtcbiAgICAgICAgaWYgKHRoaXMuc2NvcmUgPCAyMCB8fCBNYXRoLnJhbmRvbSgpID4gMC4yKSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldCA9IHRoaXMuYWxpZW47XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gYHNoaXAke1BoYXNlci5NYXRoLkJldHdlZW4oMCwgOSl9YDtcbiAgICAgICAgICAgIHRoaXMuYWxpZW4uYW5pbXMucGxheShuYW1lKTtcbiAgICAgICAgICAgIHRoaXMuYXN0ZXJvaWQueSA9IC0xMDA7XG4gICAgICAgICAgICBpZiAodGhpcy5hbGllblNvdW5kKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnNldFNlZWsoMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnNldFJhdGUoZnJlcSk7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnBsYXkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy5hc3Rlcm9pZDtcbiAgICAgICAgICAgIHRoaXMuYWxpZW4ueSA9IC0xMDA7XG4gICAgICAgICAgICBpZiAodGhpcy5hbGllblNvdW5kKVxuICAgICAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZC5zdG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50YXJnZXQueSA9IDA7XG4gICAgICAgIHRoaXMuYXR0YWNrID0gdGhpcy50d2VlbnMuYWRkKHtcbiAgICAgICAgICAgIGtleTogXCJhdHRhY2tcIixcbiAgICAgICAgICAgIHRhcmdldHM6IHRoaXMudGFyZ2V0LFxuICAgICAgICAgICAgeTogdGhpcy5jYW52YXMuaGVpZ2h0LFxuICAgICAgICAgICAgb25VcGRhdGU6ICh0d2VlbiwgdGFyZ2V0KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdSA9IHRhcmdldC55IC8gdGhpcy5jYW52YXMuaGVpZ2h0O1xuICAgICAgICAgICAgICAgIGNvbnN0IGdvYWxfeCA9IHcgKiAoMSAvIDQgKyBsYW5lIC8gMik7XG4gICAgICAgICAgICAgICAgY29uc3Qgd2lnZ2xlID0gdyAqXG4gICAgICAgICAgICAgICAgICAgICgxIC8gMiArXG4gICAgICAgICAgICAgICAgICAgICAgICAoTWF0aC5taW4oMTAsIHRoaXMuc2NvcmUpIC8gMjApICpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2lnbiAqIE1hdGguc2luKDIgKiBNYXRoLlBJICogZnJlcSAqIHUpKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdiA9IE1hdGgubWluKDEsIHRhcmdldC55IC8gdGhpcy5yb2NrZXRfeSk7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LnggPSAoMSAtIHYpICogd2lnZ2xlICsgdiAqIGdvYWxfeDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hbGllblNvdW5kKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFsaWVuU291bmQuc2V0Vm9sdW1lKHUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6ICgpID0+IHRoaXMucmVzZXQoKSxcbiAgICAgICAgICAgIGR1cmF0aW9uOiB0aGlzLnBlcmlvZFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50YXJnZXQuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgdGhpcy5jb2xsaWRlci5hY3RpdmUgPSB0cnVlO1xuICAgICAgICB0aGlzLnRpbWUuZGVsYXllZENhbGwodGhpcy5wZXJpb2QgLyAyLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmF0dGFjay5wYXVzZSgpO1xuICAgICAgICAgICAgdGhpcy5nZXRVc2VySW5wdXQodGhpcy50YXJnZXQgPT09IHRoaXMuYWxpZW4gPyBsYW5lIDogMSAtIGxhbmUsICh2KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2sucmVzdW1lKCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9ja2V0X3ggPSB3ICogKDEgLyA0ICsgdiAvIDIpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvY2tldC54IDwgcm9ja2V0X3gpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbnMuYWRkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMucm9ja2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiB7IHZhbHVlOiAoMyAqIHcpIC8gNCwgZHVyYXRpb246IDUwMCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uOiB7IHZhbHVlOiBNYXRoLlBJIC8gMiwgZHVyYXRpb246IDI1MCwgeW95bzogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLnJvY2tldC54ID4gcm9ja2V0X3gpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbnMuYWRkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMucm9ja2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiB7IHZhbHVlOiB3IC8gNCwgZHVyYXRpb246IDUwMCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAtTWF0aC5QSSAvIDIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAyNTAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlveW86IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBbXSwgdGhpcyk7XG4gICAgfVxuICAgIHJvY2tldENvbGxpZGVXaXRoQWxpZW4oKSB7XG4gICAgICAgIGlmICh0aGlzLnRhcmdldCA9PSB0aGlzLmFsaWVuKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wb3BTb3VuZClcbiAgICAgICAgICAgICAgICB0aGlzLnBvcFNvdW5kLnBsYXkoKTtcbiAgICAgICAgICAgIHRoaXMuY2FtZXJhcy5tYWluLmZsYXNoKCk7XG4gICAgICAgICAgICB0aGlzLnNjb3JlICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5leHBsb2RlU291bmQpXG4gICAgICAgICAgICAgICAgdGhpcy5leHBsb2RlU291bmQucGxheSgpO1xuICAgICAgICAgICAgdGhpcy5jYW1lcmFzLm1haW4uZmxhc2goNTAwLCAyNTUsIDAsIDApO1xuICAgICAgICAgICAgdGhpcy5zY29yZSAtPSAxO1xuICAgICAgICB9XG4gICAgICAgIC8vIEhpZGUgdGhlIHRhcmdldFxuICAgICAgICB0aGlzLnRhcmdldC52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIC8vIHByZXZlbnQgbXVsdGlwbGUgY29sbGlzaW9uc1xuICAgICAgICB0aGlzLmNvbGxpZGVyLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAvLyBibG93dXBcbiAgICAgICAgdGhpcy5wYXJ0aWNsZXMuZW1pdFBhcnRpY2xlQXQodGhpcy50YXJnZXQueCwgdGhpcy50YXJnZXQueSk7XG4gICAgICAgIC8vIGRpc3BsYXkgc2NvcmVcbiAgICAgICAgdGhpcy5zY29yZURpc3BsYXkuc2V0VGV4dChcIlwiICsgdGhpcy5zY29yZSk7XG4gICAgfVxufVxuIiwiaW1wb3J0IFwicGhhc2VyXCI7XG5pbXBvcnQgeyBHYW1lU2NlbmUgfSBmcm9tIFwiLi9nYW1lXCI7XG5pbXBvcnQgc2V0dGluZ3MgZnJvbSBcIi4vc2V0dGluZ3NcIjtcbmNvbnN0IGNvbmZpZyA9IHtcbiAgICB0aXRsZTogXCJTcGFjZVwiLFxuICAgIHR5cGU6IFBoYXNlci5BVVRPLFxuICAgIHdpZHRoOiA2MDAsXG4gICAgaGVpZ2h0OiA4MDAsXG4gICAgc2NhbGU6IHtcbiAgICAgICAgbW9kZTogUGhhc2VyLlNjYWxlLlJFU0laRSxcbiAgICAgICAgYXV0b0NlbnRlcjogUGhhc2VyLlNjYWxlLkNFTlRFUl9CT1RIXG4gICAgfSxcbiAgICBwYXJlbnQ6IFwiZ2FtZVwiLFxuICAgIHNjZW5lOiBbR2FtZVNjZW5lXSxcbiAgICBwaHlzaWNzOiB7XG4gICAgICAgIGRlZmF1bHQ6IFwiYXJjYWRlXCIsXG4gICAgICAgIGFyY2FkZToge1xuICAgICAgICAgICAgZGVidWc6IGZhbHNlXG4gICAgICAgIH1cbiAgICB9LFxuICAgIGJhY2tncm91bmRDb2xvcjogXCIjMTAxMDEwXCJcbn07XG5leHBvcnQgY2xhc3MgTXlHYW1lIGV4dGVuZHMgUGhhc2VyLkdhbWUge1xuICAgIGNvbnN0cnVjdG9yKGNvbmZpZykge1xuICAgICAgICBzdXBlcihjb25maWcpO1xuICAgIH1cbn1cbndpbmRvdy5vbmxvYWQgPSAoKSA9PiB7XG4gICAgbGV0IGdhbWUgPSBudWxsO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2V0dXBcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgaWYgKGdhbWUpIHtcbiAgICAgICAgICAgIGdhbWUuZGVzdHJveSh0cnVlKTtcbiAgICAgICAgICAgIGdhbWUgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnZhbHVlID0gXCJzZXR0aW5nc1wiO1xuICAgIH0pO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheUJ1dHRvblwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC52YWx1ZSA9IFwicGxheVwiO1xuICAgICAgICBnYW1lID0gbmV3IE15R2FtZShjb25maWcpO1xuICAgIH0pO1xuICAgIFsuLi5kb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiaW5wdXRbbmFtZT1tb2RlXVwiKV0ubWFwKChub2RlKSA9PiAobm9kZS5jaGVja2VkID0gbm9kZS52YWx1ZSA9PSBzZXR0aW5ncy5tb2RlKSk7XG4gICAgY29uc3Qgc291bmRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic291bmRcIik7XG4gICAgc291bmRJbnB1dC5jaGVja2VkID0gc2V0dGluZ3Muc291bmQ7XG4gICAgY29uc3QgYXN0ZXJvaWRzSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFzdGVyb2lkc1wiKTtcbiAgICBhc3Rlcm9pZHNJbnB1dC5jaGVja2VkID0gc2V0dGluZ3MuYXN0ZXJvaWRzO1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2V0dGluZ3NcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBlID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjaGFuZ2VcIik7XG4gICAgICAgIGNvbnN0IG1vZGVJbnB1dCA9IChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaW5wdXRbbmFtZT1tb2RlXTpjaGVja2VkXCIpKTtcbiAgICAgICAgY29uc3QgbW9kZSA9IG1vZGVJbnB1dC52YWx1ZTtcbiAgICAgICAgc2V0dGluZ3MubW9kZSA9IG1vZGU7XG4gICAgICAgIGNvbnN0IHNvdW5kSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvdW5kXCIpO1xuICAgICAgICBzZXR0aW5ncy5zb3VuZCA9IHNvdW5kSW5wdXQuY2hlY2tlZDtcbiAgICAgICAgY29uc3QgYXN0ZXJvaWRzSW5wdXQgPSAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhc3Rlcm9pZHNcIikpO1xuICAgICAgICBzZXR0aW5ncy5hc3Rlcm9pZHMgPSBhc3Rlcm9pZHNJbnB1dC5jaGVja2VkO1xuICAgICAgICBzZXR0aW5ncy5wZXJzaXN0KCk7XG4gICAgfSk7XG59O1xuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///1\n')}]);