!function(I){var g={};function C(A){if(g[A])return g[A].exports;var t=g[A]={i:A,l:!1,exports:{}};return I[A].call(t.exports,t,t.exports,C),t.l=!0,t.exports}C.m=I,C.c=g,C.d=function(I,g,A){C.o(I,g)||Object.defineProperty(I,g,{enumerable:!0,get:A})},C.r=function(I){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})},C.t=function(I,g){if(1&g&&(I=C(I)),8&g)return I;if(4&g&&"object"==typeof I&&I&&I.__esModule)return I;var A=Object.create(null);if(C.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:I}),2&g&&"string"!=typeof I)for(var t in I)C.d(A,t,function(g){return I[g]}.bind(null,t));return A},C.n=function(I){var g=I&&I.__esModule?function(){return I.default}:function(){return I};return C.d(g,"a",g),g},C.o=function(I,g){return Object.prototype.hasOwnProperty.call(I,g)},C.p="",C(C.s=1)}([function(module,exports){eval("module.exports = Phaser;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJQaGFzZXJcIj9lYmM2Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IFBoYXNlcjsiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: external "Phaser"\nvar external_Phaser_ = __webpack_require__(0);\n\n// CONCATENATED MODULE: ./src/settings.ts\nconst key = "space-config";\nconst version = 2;\nclass Settings {\n    constructor() {\n        this.mode = "auto";\n        this.sound = true;\n        this.asteroids = true;\n    }\n    persist() {\n        const data = {\n            version: version,\n            mode: this.mode,\n            sound: this.sound,\n            asteroids: this.asteroids\n        };\n        const json = JSON.stringify(data);\n        localStorage.setItem(key, json);\n    }\n    restore() {\n        const json = localStorage.getItem(key);\n        if (json) {\n            const data = JSON.parse(json);\n            if (data.version == version) {\n                this.mode = data.mode;\n                this.sound = data.sound;\n                this.asteroids = data.asteroids;\n            }\n        }\n    }\n}\nconst settings = new Settings();\nsettings.restore();\n/* harmony default export */ var src_settings = (settings);\n\n// CONCATENATED MODULE: ./src/base.ts\n\n\nclass base_SwitchBase extends Phaser.Scene {\n    constructor(args) {\n        super(args);\n        this.waiting = false; // true when waiting for input\n    }\n    getUserInput(correct, func) {\n        this.waiting = true;\n        this.correct = correct;\n        this.callback = func;\n        if (src_settings.mode == "auto") {\n            this.time.delayedCall(1000, () => {\n                this.returnInput(this.correct);\n            }, [], this);\n        }\n    }\n    returnInput(value) {\n        // ignore if not waiting\n        if (!this.waiting) {\n            return;\n        }\n        // display the choice\n        this.setSelected(value);\n        // return the correct answer in one-switch mode\n        if (src_settings.mode == "one") {\n            value = this.correct;\n        }\n        // return the answer through the callback\n        this.callback(value);\n        // ignore input\n        this.waiting = false;\n    }\n    setSelected(choice) {\n        const choices = document.querySelectorAll("button.choice");\n        let selected = document.querySelector("button.selected");\n        if (selected) {\n            selected.classList.remove("selected");\n        }\n        choices[choice].classList.add("selected");\n    }\n    create() {\n        // bind left and right arrow for direct selection\n        this.input.keyboard.on("keydown-LEFT", (e) => {\n            // pass response back to caller\n            this.returnInput(0);\n        });\n        this.input.keyboard.on("keydown-RIGHT", (e) => {\n            // pass response back to caller\n            this.returnInput(1);\n        });\n        // bind the buttons for direct selection\n        document\n            .getElementById("left")\n            .addEventListener("click", e => this.returnInput(0));\n        document\n            .getElementById("right")\n            .addEventListener("click", e => this.returnInput(1));\n        // bind space for 2-switch mover\n        this.input.keyboard.on("keydown-SPACE", (e) => {\n            const choices = document.querySelectorAll("button.choice");\n            let selected = document.querySelector("button.selected");\n            let i = 0;\n            if (selected) {\n                i = ([...choices].indexOf(selected) + 1) % choices.length;\n                selected.classList.remove("selected");\n            }\n            choices[i].classList.add("selected");\n        });\n        // bind enter for 2-switch chooser\n        this.input.keyboard.on("keydown-ENTER", (e) => {\n            const selected = (document.querySelector("button.selected"));\n            if (selected) {\n                selected.click();\n            }\n        });\n    }\n}\n\n// CONCATENATED MODULE: ./src/game.ts\n\n\n\n// time for the attack\nconst period = 2000;\n// height of the rocket\nconst rocketYFraction = 0.9;\nclass game_GameScene extends base_SwitchBase {\n    constructor() {\n        super({\n            key: "GameScene"\n        });\n        this.canvas = document.querySelector("canvas");\n        this.score = 0;\n        this.popSound = null;\n        this.alienSound = null;\n        this.explodeSound = null;\n    }\n    preload() {\n        this.load.spritesheet("alien", "assets/alien-sheet.png", {\n            frameWidth: 73,\n            frameHeight: 44,\n            startFrame: 0,\n            endFrame: 39\n        });\n        this.load.spritesheet("asteroid", "assets/asteroid-sheet.png", {\n            frameWidth: 120,\n            frameHeight: 120,\n            startFrame: 0,\n            endFrame: 15\n        });\n        this.load.spritesheet("rocket", "assets/rocket-sheet.png", {\n            frameWidth: 110,\n            frameHeight: 246,\n            startFrame: 0,\n            endFrame: 2\n        });\n        this.load.image("particle", "assets/particle.png");\n        if (src_settings.sound) {\n            this.load.audio("pop", "assets/success.mp3");\n            this.load.audio("alienSound", "assets/alien.mp3");\n            this.load.audio("explodeSound", "assets/explode.mp3");\n        }\n    }\n    create() {\n        super.create();\n        // moving stars to give a sense of motion\n        const starPeriod = 4 * period;\n        for (let s = 0; s < 100; s++) {\n            let star = this.add.graphics();\n            star.fillStyle(0xffffff);\n            star.fillPoint(Phaser.Math.Between(0, this.canvas.width), 0, 2);\n            this.tweens.add({\n                targets: star,\n                duration: starPeriod,\n                delay: Phaser.Math.Between(0, starPeriod),\n                repeat: -1,\n                repeatDelay: Phaser.Math.Between(100, 500),\n                y: this.canvas.height,\n                onRepeat: () => {\n                    star.x = Phaser.Math.Between(0, this.canvas.width);\n                }\n            });\n        }\n        // score\n        this.scoreDisplay = this.add.text(20, 20, "0", { fontSize: 20 });\n        // alien ships\n        this.alien = this.add.sprite(this.canvas.width / 2, 10, "alien");\n        for (let i = 0; i < 10; i++) {\n            let name = `ship${i}`;\n            let a = this.anims.create({\n                key: name,\n                frames: this.anims.generateFrameNumbers("alien", {\n                    start: i * 4,\n                    end: i * 4 + 3\n                }),\n                frameRate: 10,\n                repeat: -1\n            });\n            this.alien.anims.load(name);\n        }\n        // asteroid\n        this.asteroid = this.add.sprite(0, 0, "asteroid");\n        this.anims.create({\n            key: "spin",\n            frames: this.anims.generateFrameNumbers("asteroid", {}),\n            frameRate: 20,\n            repeat: -1\n        });\n        this.asteroid.anims.load("spin");\n        this.asteroid.anims.play("spin");\n        // rocket\n        this.rocket = this.add.sprite((3 * this.canvas.width) / 4, rocketYFraction * this.canvas.height, "rocket");\n        this.rocket.setScale(0.5);\n        this.anims.create({\n            key: "flicker",\n            frames: this.anims.generateFrameNumbers("rocket", {}),\n            frameRate: 15,\n            repeat: -1\n        });\n        this.rocket.anims.load("flicker");\n        this.rocket.anims.play("flicker");\n        // Enable physics on rocket and alien sprites\n        this.physics.world.enable([this.rocket, this.alien, this.asteroid]);\n        this.collider = this.physics.add.overlap(this.rocket, [this.alien, this.asteroid], this.rocketCollideWithAlien, null, this);\n        // blow up the alien\n        this.particles = this.add.particles("particle");\n        this.emitter = this.particles.createEmitter({\n            angle: { min: 0, max: 360 },\n            speed: { min: 50, max: 200 },\n            quantity: { min: 40, max: 50 },\n            lifespan: { min: 200, max: 500 },\n            alpha: { start: 1, end: 0 },\n            scale: { min: 0.5, max: 0.5 },\n            rotate: { start: 0, end: 360 },\n            gravityY: 800,\n            on: false\n        });\n        this.reset();\n        // control sound\n        if (src_settings.sound) {\n            this.popSound = this.sound.add("pop");\n            this.alienSound = (this.sound.add("alienSound"));\n            this.alienSound.setLoop(true);\n            this.alienSound.play();\n            this.explodeSound = (this.sound.add("explodeSound"));\n        }\n    }\n    reset() {\n        const w = this.canvas.width;\n        // choose the next correct answer\n        const lane = Phaser.Math.Between(0, 1);\n        // initial direction of flight\n        const sign = 2 * Phaser.Math.Between(0, 1) - 1;\n        // curvyness\n        const freq = 0.5 + Math.random() * 2;\n        // choose an alien ship or an asteroid\n        if (this.score < 20 || Math.random() > Math.min(0.5, this.score / 200)) {\n            this.target = this.alien;\n            // choose a random ship from the sheet\n            const name = `ship${Phaser.Math.Between(0, 9)}`;\n            this.alien.anims.play(name);\n            // move asteroid out of the way\n            this.asteroid.y = -100;\n            if (this.alienSound) {\n                this.alienSound.setSeek(0);\n                this.alienSound.setRate(freq);\n                this.alienSound.play();\n            }\n        }\n        else {\n            this.target = this.asteroid;\n            // move alien out of the way\n            this.alien.y = -100;\n            if (this.alienSound)\n                this.alienSound.stop();\n        }\n        // start at the top\n        this.target.y = 0;\n        // construct the objects path\n        this.attack = this.tweens.add({\n            key: "attack",\n            targets: this.target,\n            y: this.canvas.height,\n            onUpdate: (tween, target) => {\n                const v = Math.min(1, target.y / (rocketYFraction * this.canvas.height)); // 0 to 1\n                const goal_x = w * (1 / 4 + lane / 2); // x of the lane\n                // a sine wave to wiggle the attacker\n                const wiggle = w *\n                    (1 / 2 +\n                        (Math.min(10, this.score) / 20) *\n                            (sign * Math.sin(2 * Math.PI * freq * v)));\n                // linear interpolation between direct path and wiggle\n                target.x = (1 - v) * wiggle + v * goal_x;\n                // adjust the volume\n                if (this.alienSound)\n                    this.alienSound.setVolume(v);\n            },\n            onComplete: () => this.reset(),\n            duration: period\n        });\n        // make the attacker visible\n        this.target.setVisible(true);\n        // make sure we collide\n        this.collider.active = true;\n        // position the rocket\n        this.rocket.y = rocketYFraction * this.canvas.height;\n        // stop half way down so the user can input\n        this.time.delayedCall(period / 2, () => {\n            // pause the attack\n            this.attack.pause();\n            // get input\n            this.getUserInput(this.target === this.alien ? lane : 1 - lane, // correct answer\n            (v) => {\n                // once we get the input resume the attack\n                this.attack.resume();\n                // move the rocket if necessary\n                const rocket_x = w * (1 / 4 + v / 2);\n                if (this.rocket.x < rocket_x) {\n                    this.tweens.add({\n                        targets: this.rocket,\n                        props: {\n                            x: { value: (3 * w) / 4, duration: period / 4 },\n                            rotation: {\n                                value: Math.PI / 2,\n                                duration: period / 8,\n                                yoyo: true\n                            }\n                        }\n                    });\n                }\n                else if (this.rocket.x > rocket_x) {\n                    this.tweens.add({\n                        targets: this.rocket,\n                        props: {\n                            x: { value: w / 4, duration: period / 4 },\n                            rotation: {\n                                value: -Math.PI / 2,\n                                duration: period / 8,\n                                yoyo: true\n                            }\n                        }\n                    });\n                }\n            });\n        }, [], this);\n    }\n    rocketCollideWithAlien() {\n        if (this.target == this.alien) {\n            if (this.popSound)\n                this.popSound.play();\n            this.cameras.main.flash();\n            this.score += 1;\n        }\n        else {\n            if (this.explodeSound)\n                this.explodeSound.play();\n            this.cameras.main.flash(500, 255, 0, 0);\n            this.score -= Math.floor(this.score / 10);\n        }\n        // Hide the target\n        this.target.visible = false;\n        // prevent multiple collisions\n        this.collider.active = false;\n        // blowup\n        this.particles.emitParticleAt(this.target.x, this.target.y);\n        // display score\n        this.scoreDisplay.setText("" + this.score);\n    }\n}\n\n// CONCATENATED MODULE: ./src/app.ts\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MyGame", function() { return MyGame; });\n\n\n\nconst config = {\n    title: "Space",\n    type: Phaser.AUTO,\n    width: 600,\n    height: 800,\n    scale: {\n        mode: Phaser.Scale.RESIZE,\n        autoCenter: Phaser.Scale.CENTER_BOTH\n    },\n    parent: "game",\n    scene: [game_GameScene],\n    physics: {\n        default: "arcade",\n        arcade: {\n            debug: false\n        }\n    },\n    backgroundColor: "#101010"\n};\nclass MyGame extends Phaser.Game {\n    constructor(config) {\n        super(config);\n    }\n}\nwindow.onload = () => {\n    let game = null;\n    document.getElementById("setup").addEventListener("click", () => {\n        if (game) {\n            game.destroy(true);\n            game = null;\n        }\n        document.body.classList.value = "settings";\n    });\n    document.getElementById("playButton").addEventListener("click", () => {\n        document.body.classList.value = "play";\n        game = new MyGame(config);\n    });\n    [...document.querySelectorAll("input[name=mode]")].map((node) => (node.checked = node.value == src_settings.mode));\n    const soundInput = document.getElementById("sound");\n    soundInput.checked = src_settings.sound;\n    const asteroidsInput = document.getElementById("asteroids");\n    asteroidsInput.checked = src_settings.asteroids;\n    document.getElementById("settings").addEventListener("change", e => {\n        console.log("change");\n        const modeInput = (document.querySelector("input[name=mode]:checked"));\n        const mode = modeInput.value;\n        src_settings.mode = mode;\n        const soundInput = document.getElementById("sound");\n        src_settings.sound = soundInput.checked;\n        const asteroidsInput = (document.getElementById("asteroids"));\n        src_settings.asteroids = asteroidsInput.checked;\n        src_settings.persist();\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvc2V0dGluZ3MudHM/YzIzYyIsIndlYnBhY2s6Ly8vLi9zcmMvYmFzZS50cz9hZTgzIiwid2VicGFjazovLy8uL3NyYy9nYW1lLnRzP2FhZmMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FwcC50cz9mMWIyIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDZSx5REFBUSxFQUFDOzs7QUNoQ1I7QUFDa0I7QUFDM0IsTUFBTSxlQUFVO0FBQ3ZCO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksWUFBUTtBQUNwQjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWSxZQUFRO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7OztBQzdFZ0I7QUFDb0I7QUFDRjtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNPLE1BQU0sY0FBUyxTQUFTLGVBQVU7QUFDekM7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxZQUFZLFlBQVE7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFNBQVM7QUFDaEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLHdEQUF3RCxlQUFlO0FBQ3ZFO0FBQ0E7QUFDQSx1QkFBdUIsUUFBUTtBQUMvQiw4QkFBOEIsRUFBRTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0VBQWtFO0FBQ2xFO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRUFBZ0U7QUFDaEU7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLG1CQUFtQjtBQUN2QyxvQkFBb0Isb0JBQW9CO0FBQ3hDLHVCQUF1QixtQkFBbUI7QUFDMUMsdUJBQXVCLHFCQUFxQjtBQUM1QyxvQkFBb0IsbUJBQW1CO0FBQ3ZDLG9CQUFvQixxQkFBcUI7QUFDekMscUJBQXFCLHFCQUFxQjtBQUMxQztBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxZQUFZLFlBQVE7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsMEJBQTBCO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlGQUF5RjtBQUN6RixzREFBc0Q7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsMkNBQTJDO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLHFDQUFxQztBQUNyRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUI7QUFDckI7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDelBBO0FBQWdCO0FBQ21CO0FBQ0Q7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLFlBQVksY0FBUztBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsbUdBQW1HLFlBQVE7QUFDM0c7QUFDQSx5QkFBeUIsWUFBUTtBQUNqQztBQUNBLDZCQUE2QixZQUFRO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxZQUFRO0FBQ2hCO0FBQ0EsUUFBUSxZQUFRO0FBQ2hCO0FBQ0EsUUFBUSxZQUFRO0FBQ2hCLFFBQVEsWUFBUTtBQUNoQixLQUFLO0FBQ0wiLCJmaWxlIjoiMS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGtleSA9IFwic3BhY2UtY29uZmlnXCI7XG5jb25zdCB2ZXJzaW9uID0gMjtcbmNsYXNzIFNldHRpbmdzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5tb2RlID0gXCJhdXRvXCI7XG4gICAgICAgIHRoaXMuc291bmQgPSB0cnVlO1xuICAgICAgICB0aGlzLmFzdGVyb2lkcyA9IHRydWU7XG4gICAgfVxuICAgIHBlcnNpc3QoKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uLFxuICAgICAgICAgICAgbW9kZTogdGhpcy5tb2RlLFxuICAgICAgICAgICAgc291bmQ6IHRoaXMuc291bmQsXG4gICAgICAgICAgICBhc3Rlcm9pZHM6IHRoaXMuYXN0ZXJvaWRzXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBqc29uKTtcbiAgICB9XG4gICAgcmVzdG9yZSgpIHtcbiAgICAgICAgY29uc3QganNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgICAgIGlmIChqc29uKSB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShqc29uKTtcbiAgICAgICAgICAgIGlmIChkYXRhLnZlcnNpb24gPT0gdmVyc2lvbikge1xuICAgICAgICAgICAgICAgIHRoaXMubW9kZSA9IGRhdGEubW9kZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNvdW5kID0gZGF0YS5zb3VuZDtcbiAgICAgICAgICAgICAgICB0aGlzLmFzdGVyb2lkcyA9IGRhdGEuYXN0ZXJvaWRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuY29uc3Qgc2V0dGluZ3MgPSBuZXcgU2V0dGluZ3MoKTtcbnNldHRpbmdzLnJlc3RvcmUoKTtcbmV4cG9ydCBkZWZhdWx0IHNldHRpbmdzO1xuIiwiaW1wb3J0IFwicGhhc2VyXCI7XG5pbXBvcnQgc2V0dGluZ3MgZnJvbSBcIi4vc2V0dGluZ3NcIjtcbmV4cG9ydCBjbGFzcyBTd2l0Y2hCYXNlIGV4dGVuZHMgUGhhc2VyLlNjZW5lIHtcbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuICAgICAgICB0aGlzLndhaXRpbmcgPSBmYWxzZTsgLy8gdHJ1ZSB3aGVuIHdhaXRpbmcgZm9yIGlucHV0XG4gICAgfVxuICAgIGdldFVzZXJJbnB1dChjb3JyZWN0LCBmdW5jKSB7XG4gICAgICAgIHRoaXMud2FpdGluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuY29ycmVjdCA9IGNvcnJlY3Q7XG4gICAgICAgIHRoaXMuY2FsbGJhY2sgPSBmdW5jO1xuICAgICAgICBpZiAoc2V0dGluZ3MubW9kZSA9PSBcImF1dG9cIikge1xuICAgICAgICAgICAgdGhpcy50aW1lLmRlbGF5ZWRDYWxsKDEwMDAsICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnJldHVybklucHV0KHRoaXMuY29ycmVjdCk7XG4gICAgICAgICAgICB9LCBbXSwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuSW5wdXQodmFsdWUpIHtcbiAgICAgICAgLy8gaWdub3JlIGlmIG5vdCB3YWl0aW5nXG4gICAgICAgIGlmICghdGhpcy53YWl0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy8gZGlzcGxheSB0aGUgY2hvaWNlXG4gICAgICAgIHRoaXMuc2V0U2VsZWN0ZWQodmFsdWUpO1xuICAgICAgICAvLyByZXR1cm4gdGhlIGNvcnJlY3QgYW5zd2VyIGluIG9uZS1zd2l0Y2ggbW9kZVxuICAgICAgICBpZiAoc2V0dGluZ3MubW9kZSA9PSBcIm9uZVwiKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHRoaXMuY29ycmVjdDtcbiAgICAgICAgfVxuICAgICAgICAvLyByZXR1cm4gdGhlIGFuc3dlciB0aHJvdWdoIHRoZSBjYWxsYmFja1xuICAgICAgICB0aGlzLmNhbGxiYWNrKHZhbHVlKTtcbiAgICAgICAgLy8gaWdub3JlIGlucHV0XG4gICAgICAgIHRoaXMud2FpdGluZyA9IGZhbHNlO1xuICAgIH1cbiAgICBzZXRTZWxlY3RlZChjaG9pY2UpIHtcbiAgICAgICAgY29uc3QgY2hvaWNlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJidXR0b24uY2hvaWNlXCIpO1xuICAgICAgICBsZXQgc2VsZWN0ZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnNlbGVjdGVkXCIpO1xuICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIHNlbGVjdGVkLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBjaG9pY2VzW2Nob2ljZV0uY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuICAgIH1cbiAgICBjcmVhdGUoKSB7XG4gICAgICAgIC8vIGJpbmQgbGVmdCBhbmQgcmlnaHQgYXJyb3cgZm9yIGRpcmVjdCBzZWxlY3Rpb25cbiAgICAgICAgdGhpcy5pbnB1dC5rZXlib2FyZC5vbihcImtleWRvd24tTEVGVFwiLCAoZSkgPT4ge1xuICAgICAgICAgICAgLy8gcGFzcyByZXNwb25zZSBiYWNrIHRvIGNhbGxlclxuICAgICAgICAgICAgdGhpcy5yZXR1cm5JbnB1dCgwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaW5wdXQua2V5Ym9hcmQub24oXCJrZXlkb3duLVJJR0hUXCIsIChlKSA9PiB7XG4gICAgICAgICAgICAvLyBwYXNzIHJlc3BvbnNlIGJhY2sgdG8gY2FsbGVyXG4gICAgICAgICAgICB0aGlzLnJldHVybklucHV0KDEpO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gYmluZCB0aGUgYnV0dG9ucyBmb3IgZGlyZWN0IHNlbGVjdGlvblxuICAgICAgICBkb2N1bWVudFxuICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKFwibGVmdFwiKVxuICAgICAgICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+IHRoaXMucmV0dXJuSW5wdXQoMCkpO1xuICAgICAgICBkb2N1bWVudFxuICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKFwicmlnaHRcIilcbiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB0aGlzLnJldHVybklucHV0KDEpKTtcbiAgICAgICAgLy8gYmluZCBzcGFjZSBmb3IgMi1zd2l0Y2ggbW92ZXJcbiAgICAgICAgdGhpcy5pbnB1dC5rZXlib2FyZC5vbihcImtleWRvd24tU1BBQ0VcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNob2ljZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiYnV0dG9uLmNob2ljZVwiKTtcbiAgICAgICAgICAgIGxldCBzZWxlY3RlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24uc2VsZWN0ZWRcIik7XG4gICAgICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICBpID0gKFsuLi5jaG9pY2VzXS5pbmRleE9mKHNlbGVjdGVkKSArIDEpICUgY2hvaWNlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2hvaWNlc1tpXS5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBiaW5kIGVudGVyIGZvciAyLXN3aXRjaCBjaG9vc2VyXG4gICAgICAgIHRoaXMuaW5wdXQua2V5Ym9hcmQub24oXCJrZXlkb3duLUVOVEVSXCIsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnNlbGVjdGVkXCIpKTtcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkLmNsaWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiIsImltcG9ydCBcInBoYXNlclwiO1xuaW1wb3J0IHsgU3dpdGNoQmFzZSB9IGZyb20gXCIuL2Jhc2VcIjtcbmltcG9ydCBzZXR0aW5ncyBmcm9tIFwiLi9zZXR0aW5nc1wiO1xuLy8gdGltZSBmb3IgdGhlIGF0dGFja1xuY29uc3QgcGVyaW9kID0gMjAwMDtcbi8vIGhlaWdodCBvZiB0aGUgcm9ja2V0XG5jb25zdCByb2NrZXRZRnJhY3Rpb24gPSAwLjk7XG5leHBvcnQgY2xhc3MgR2FtZVNjZW5lIGV4dGVuZHMgU3dpdGNoQmFzZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKHtcbiAgICAgICAgICAgIGtleTogXCJHYW1lU2NlbmVcIlxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiY2FudmFzXCIpO1xuICAgICAgICB0aGlzLnNjb3JlID0gMDtcbiAgICAgICAgdGhpcy5wb3BTb3VuZCA9IG51bGw7XG4gICAgICAgIHRoaXMuYWxpZW5Tb3VuZCA9IG51bGw7XG4gICAgICAgIHRoaXMuZXhwbG9kZVNvdW5kID0gbnVsbDtcbiAgICB9XG4gICAgcHJlbG9hZCgpIHtcbiAgICAgICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KFwiYWxpZW5cIiwgXCJhc3NldHMvYWxpZW4tc2hlZXQucG5nXCIsIHtcbiAgICAgICAgICAgIGZyYW1lV2lkdGg6IDczLFxuICAgICAgICAgICAgZnJhbWVIZWlnaHQ6IDQ0LFxuICAgICAgICAgICAgc3RhcnRGcmFtZTogMCxcbiAgICAgICAgICAgIGVuZEZyYW1lOiAzOVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5sb2FkLnNwcml0ZXNoZWV0KFwiYXN0ZXJvaWRcIiwgXCJhc3NldHMvYXN0ZXJvaWQtc2hlZXQucG5nXCIsIHtcbiAgICAgICAgICAgIGZyYW1lV2lkdGg6IDEyMCxcbiAgICAgICAgICAgIGZyYW1lSGVpZ2h0OiAxMjAsXG4gICAgICAgICAgICBzdGFydEZyYW1lOiAwLFxuICAgICAgICAgICAgZW5kRnJhbWU6IDE1XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoXCJyb2NrZXRcIiwgXCJhc3NldHMvcm9ja2V0LXNoZWV0LnBuZ1wiLCB7XG4gICAgICAgICAgICBmcmFtZVdpZHRoOiAxMTAsXG4gICAgICAgICAgICBmcmFtZUhlaWdodDogMjQ2LFxuICAgICAgICAgICAgc3RhcnRGcmFtZTogMCxcbiAgICAgICAgICAgIGVuZEZyYW1lOiAyXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJwYXJ0aWNsZVwiLCBcImFzc2V0cy9wYXJ0aWNsZS5wbmdcIik7XG4gICAgICAgIGlmIChzZXR0aW5ncy5zb3VuZCkge1xuICAgICAgICAgICAgdGhpcy5sb2FkLmF1ZGlvKFwicG9wXCIsIFwiYXNzZXRzL3N1Y2Nlc3MubXAzXCIpO1xuICAgICAgICAgICAgdGhpcy5sb2FkLmF1ZGlvKFwiYWxpZW5Tb3VuZFwiLCBcImFzc2V0cy9hbGllbi5tcDNcIik7XG4gICAgICAgICAgICB0aGlzLmxvYWQuYXVkaW8oXCJleHBsb2RlU291bmRcIiwgXCJhc3NldHMvZXhwbG9kZS5tcDNcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3JlYXRlKCkge1xuICAgICAgICBzdXBlci5jcmVhdGUoKTtcbiAgICAgICAgLy8gbW92aW5nIHN0YXJzIHRvIGdpdmUgYSBzZW5zZSBvZiBtb3Rpb25cbiAgICAgICAgY29uc3Qgc3RhclBlcmlvZCA9IDQgKiBwZXJpb2Q7XG4gICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgMTAwOyBzKyspIHtcbiAgICAgICAgICAgIGxldCBzdGFyID0gdGhpcy5hZGQuZ3JhcGhpY3MoKTtcbiAgICAgICAgICAgIHN0YXIuZmlsbFN0eWxlKDB4ZmZmZmZmKTtcbiAgICAgICAgICAgIHN0YXIuZmlsbFBvaW50KFBoYXNlci5NYXRoLkJldHdlZW4oMCwgdGhpcy5jYW52YXMud2lkdGgpLCAwLCAyKTtcbiAgICAgICAgICAgIHRoaXMudHdlZW5zLmFkZCh7XG4gICAgICAgICAgICAgICAgdGFyZ2V0czogc3RhcixcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogc3RhclBlcmlvZCxcbiAgICAgICAgICAgICAgICBkZWxheTogUGhhc2VyLk1hdGguQmV0d2VlbigwLCBzdGFyUGVyaW9kKSxcbiAgICAgICAgICAgICAgICByZXBlYXQ6IC0xLFxuICAgICAgICAgICAgICAgIHJlcGVhdERlbGF5OiBQaGFzZXIuTWF0aC5CZXR3ZWVuKDEwMCwgNTAwKSxcbiAgICAgICAgICAgICAgICB5OiB0aGlzLmNhbnZhcy5oZWlnaHQsXG4gICAgICAgICAgICAgICAgb25SZXBlYXQ6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgc3Rhci54ID0gUGhhc2VyLk1hdGguQmV0d2VlbigwLCB0aGlzLmNhbnZhcy53aWR0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gc2NvcmVcbiAgICAgICAgdGhpcy5zY29yZURpc3BsYXkgPSB0aGlzLmFkZC50ZXh0KDIwLCAyMCwgXCIwXCIsIHsgZm9udFNpemU6IDIwIH0pO1xuICAgICAgICAvLyBhbGllbiBzaGlwc1xuICAgICAgICB0aGlzLmFsaWVuID0gdGhpcy5hZGQuc3ByaXRlKHRoaXMuY2FudmFzLndpZHRoIC8gMiwgMTAsIFwiYWxpZW5cIik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgICAgICAgbGV0IG5hbWUgPSBgc2hpcCR7aX1gO1xuICAgICAgICAgICAgbGV0IGEgPSB0aGlzLmFuaW1zLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAga2V5OiBuYW1lLFxuICAgICAgICAgICAgICAgIGZyYW1lczogdGhpcy5hbmltcy5nZW5lcmF0ZUZyYW1lTnVtYmVycyhcImFsaWVuXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGkgKiA0LFxuICAgICAgICAgICAgICAgICAgICBlbmQ6IGkgKiA0ICsgM1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGZyYW1lUmF0ZTogMTAsXG4gICAgICAgICAgICAgICAgcmVwZWF0OiAtMVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmFsaWVuLmFuaW1zLmxvYWQobmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gYXN0ZXJvaWRcbiAgICAgICAgdGhpcy5hc3Rlcm9pZCA9IHRoaXMuYWRkLnNwcml0ZSgwLCAwLCBcImFzdGVyb2lkXCIpO1xuICAgICAgICB0aGlzLmFuaW1zLmNyZWF0ZSh7XG4gICAgICAgICAgICBrZXk6IFwic3BpblwiLFxuICAgICAgICAgICAgZnJhbWVzOiB0aGlzLmFuaW1zLmdlbmVyYXRlRnJhbWVOdW1iZXJzKFwiYXN0ZXJvaWRcIiwge30pLFxuICAgICAgICAgICAgZnJhbWVSYXRlOiAyMCxcbiAgICAgICAgICAgIHJlcGVhdDogLTFcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYXN0ZXJvaWQuYW5pbXMubG9hZChcInNwaW5cIik7XG4gICAgICAgIHRoaXMuYXN0ZXJvaWQuYW5pbXMucGxheShcInNwaW5cIik7XG4gICAgICAgIC8vIHJvY2tldFxuICAgICAgICB0aGlzLnJvY2tldCA9IHRoaXMuYWRkLnNwcml0ZSgoMyAqIHRoaXMuY2FudmFzLndpZHRoKSAvIDQsIHJvY2tldFlGcmFjdGlvbiAqIHRoaXMuY2FudmFzLmhlaWdodCwgXCJyb2NrZXRcIik7XG4gICAgICAgIHRoaXMucm9ja2V0LnNldFNjYWxlKDAuNSk7XG4gICAgICAgIHRoaXMuYW5pbXMuY3JlYXRlKHtcbiAgICAgICAgICAgIGtleTogXCJmbGlja2VyXCIsXG4gICAgICAgICAgICBmcmFtZXM6IHRoaXMuYW5pbXMuZ2VuZXJhdGVGcmFtZU51bWJlcnMoXCJyb2NrZXRcIiwge30pLFxuICAgICAgICAgICAgZnJhbWVSYXRlOiAxNSxcbiAgICAgICAgICAgIHJlcGVhdDogLTFcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucm9ja2V0LmFuaW1zLmxvYWQoXCJmbGlja2VyXCIpO1xuICAgICAgICB0aGlzLnJvY2tldC5hbmltcy5wbGF5KFwiZmxpY2tlclwiKTtcbiAgICAgICAgLy8gRW5hYmxlIHBoeXNpY3Mgb24gcm9ja2V0IGFuZCBhbGllbiBzcHJpdGVzXG4gICAgICAgIHRoaXMucGh5c2ljcy53b3JsZC5lbmFibGUoW3RoaXMucm9ja2V0LCB0aGlzLmFsaWVuLCB0aGlzLmFzdGVyb2lkXSk7XG4gICAgICAgIHRoaXMuY29sbGlkZXIgPSB0aGlzLnBoeXNpY3MuYWRkLm92ZXJsYXAodGhpcy5yb2NrZXQsIFt0aGlzLmFsaWVuLCB0aGlzLmFzdGVyb2lkXSwgdGhpcy5yb2NrZXRDb2xsaWRlV2l0aEFsaWVuLCBudWxsLCB0aGlzKTtcbiAgICAgICAgLy8gYmxvdyB1cCB0aGUgYWxpZW5cbiAgICAgICAgdGhpcy5wYXJ0aWNsZXMgPSB0aGlzLmFkZC5wYXJ0aWNsZXMoXCJwYXJ0aWNsZVwiKTtcbiAgICAgICAgdGhpcy5lbWl0dGVyID0gdGhpcy5wYXJ0aWNsZXMuY3JlYXRlRW1pdHRlcih7XG4gICAgICAgICAgICBhbmdsZTogeyBtaW46IDAsIG1heDogMzYwIH0sXG4gICAgICAgICAgICBzcGVlZDogeyBtaW46IDUwLCBtYXg6IDIwMCB9LFxuICAgICAgICAgICAgcXVhbnRpdHk6IHsgbWluOiA0MCwgbWF4OiA1MCB9LFxuICAgICAgICAgICAgbGlmZXNwYW46IHsgbWluOiAyMDAsIG1heDogNTAwIH0sXG4gICAgICAgICAgICBhbHBoYTogeyBzdGFydDogMSwgZW5kOiAwIH0sXG4gICAgICAgICAgICBzY2FsZTogeyBtaW46IDAuNSwgbWF4OiAwLjUgfSxcbiAgICAgICAgICAgIHJvdGF0ZTogeyBzdGFydDogMCwgZW5kOiAzNjAgfSxcbiAgICAgICAgICAgIGdyYXZpdHlZOiA4MDAsXG4gICAgICAgICAgICBvbjogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgLy8gY29udHJvbCBzb3VuZFxuICAgICAgICBpZiAoc2V0dGluZ3Muc291bmQpIHtcbiAgICAgICAgICAgIHRoaXMucG9wU291bmQgPSB0aGlzLnNvdW5kLmFkZChcInBvcFwiKTtcbiAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZCA9ICh0aGlzLnNvdW5kLmFkZChcImFsaWVuU291bmRcIikpO1xuICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnNldExvb3AodHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmFsaWVuU291bmQucGxheSgpO1xuICAgICAgICAgICAgdGhpcy5leHBsb2RlU291bmQgPSAodGhpcy5zb3VuZC5hZGQoXCJleHBsb2RlU291bmRcIikpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlc2V0KCkge1xuICAgICAgICBjb25zdCB3ID0gdGhpcy5jYW52YXMud2lkdGg7XG4gICAgICAgIC8vIGNob29zZSB0aGUgbmV4dCBjb3JyZWN0IGFuc3dlclxuICAgICAgICBjb25zdCBsYW5lID0gUGhhc2VyLk1hdGguQmV0d2VlbigwLCAxKTtcbiAgICAgICAgLy8gaW5pdGlhbCBkaXJlY3Rpb24gb2YgZmxpZ2h0XG4gICAgICAgIGNvbnN0IHNpZ24gPSAyICogUGhhc2VyLk1hdGguQmV0d2VlbigwLCAxKSAtIDE7XG4gICAgICAgIC8vIGN1cnZ5bmVzc1xuICAgICAgICBjb25zdCBmcmVxID0gMC41ICsgTWF0aC5yYW5kb20oKSAqIDI7XG4gICAgICAgIC8vIGNob29zZSBhbiBhbGllbiBzaGlwIG9yIGFuIGFzdGVyb2lkXG4gICAgICAgIGlmICh0aGlzLnNjb3JlIDwgMjAgfHwgTWF0aC5yYW5kb20oKSA+IE1hdGgubWluKDAuNSwgdGhpcy5zY29yZSAvIDIwMCkpIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy5hbGllbjtcbiAgICAgICAgICAgIC8vIGNob29zZSBhIHJhbmRvbSBzaGlwIGZyb20gdGhlIHNoZWV0XG4gICAgICAgICAgICBjb25zdCBuYW1lID0gYHNoaXAke1BoYXNlci5NYXRoLkJldHdlZW4oMCwgOSl9YDtcbiAgICAgICAgICAgIHRoaXMuYWxpZW4uYW5pbXMucGxheShuYW1lKTtcbiAgICAgICAgICAgIC8vIG1vdmUgYXN0ZXJvaWQgb3V0IG9mIHRoZSB3YXlcbiAgICAgICAgICAgIHRoaXMuYXN0ZXJvaWQueSA9IC0xMDA7XG4gICAgICAgICAgICBpZiAodGhpcy5hbGllblNvdW5kKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnNldFNlZWsoMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnNldFJhdGUoZnJlcSk7XG4gICAgICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnBsYXkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy5hc3Rlcm9pZDtcbiAgICAgICAgICAgIC8vIG1vdmUgYWxpZW4gb3V0IG9mIHRoZSB3YXlcbiAgICAgICAgICAgIHRoaXMuYWxpZW4ueSA9IC0xMDA7XG4gICAgICAgICAgICBpZiAodGhpcy5hbGllblNvdW5kKVxuICAgICAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZC5zdG9wKCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gc3RhcnQgYXQgdGhlIHRvcFxuICAgICAgICB0aGlzLnRhcmdldC55ID0gMDtcbiAgICAgICAgLy8gY29uc3RydWN0IHRoZSBvYmplY3RzIHBhdGhcbiAgICAgICAgdGhpcy5hdHRhY2sgPSB0aGlzLnR3ZWVucy5hZGQoe1xuICAgICAgICAgICAga2V5OiBcImF0dGFja1wiLFxuICAgICAgICAgICAgdGFyZ2V0czogdGhpcy50YXJnZXQsXG4gICAgICAgICAgICB5OiB0aGlzLmNhbnZhcy5oZWlnaHQsXG4gICAgICAgICAgICBvblVwZGF0ZTogKHR3ZWVuLCB0YXJnZXQpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB2ID0gTWF0aC5taW4oMSwgdGFyZ2V0LnkgLyAocm9ja2V0WUZyYWN0aW9uICogdGhpcy5jYW52YXMuaGVpZ2h0KSk7IC8vIDAgdG8gMVxuICAgICAgICAgICAgICAgIGNvbnN0IGdvYWxfeCA9IHcgKiAoMSAvIDQgKyBsYW5lIC8gMik7IC8vIHggb2YgdGhlIGxhbmVcbiAgICAgICAgICAgICAgICAvLyBhIHNpbmUgd2F2ZSB0byB3aWdnbGUgdGhlIGF0dGFja2VyXG4gICAgICAgICAgICAgICAgY29uc3Qgd2lnZ2xlID0gdyAqXG4gICAgICAgICAgICAgICAgICAgICgxIC8gMiArXG4gICAgICAgICAgICAgICAgICAgICAgICAoTWF0aC5taW4oMTAsIHRoaXMuc2NvcmUpIC8gMjApICpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2lnbiAqIE1hdGguc2luKDIgKiBNYXRoLlBJICogZnJlcSAqIHYpKSk7XG4gICAgICAgICAgICAgICAgLy8gbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiBkaXJlY3QgcGF0aCBhbmQgd2lnZ2xlXG4gICAgICAgICAgICAgICAgdGFyZ2V0LnggPSAoMSAtIHYpICogd2lnZ2xlICsgdiAqIGdvYWxfeDtcbiAgICAgICAgICAgICAgICAvLyBhZGp1c3QgdGhlIHZvbHVtZVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmFsaWVuU291bmQpXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZC5zZXRWb2x1bWUodik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25Db21wbGV0ZTogKCkgPT4gdGhpcy5yZXNldCgpLFxuICAgICAgICAgICAgZHVyYXRpb246IHBlcmlvZFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gbWFrZSB0aGUgYXR0YWNrZXIgdmlzaWJsZVxuICAgICAgICB0aGlzLnRhcmdldC5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAvLyBtYWtlIHN1cmUgd2UgY29sbGlkZVxuICAgICAgICB0aGlzLmNvbGxpZGVyLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgIC8vIHBvc2l0aW9uIHRoZSByb2NrZXRcbiAgICAgICAgdGhpcy5yb2NrZXQueSA9IHJvY2tldFlGcmFjdGlvbiAqIHRoaXMuY2FudmFzLmhlaWdodDtcbiAgICAgICAgLy8gc3RvcCBoYWxmIHdheSBkb3duIHNvIHRoZSB1c2VyIGNhbiBpbnB1dFxuICAgICAgICB0aGlzLnRpbWUuZGVsYXllZENhbGwocGVyaW9kIC8gMiwgKCkgPT4ge1xuICAgICAgICAgICAgLy8gcGF1c2UgdGhlIGF0dGFja1xuICAgICAgICAgICAgdGhpcy5hdHRhY2sucGF1c2UoKTtcbiAgICAgICAgICAgIC8vIGdldCBpbnB1dFxuICAgICAgICAgICAgdGhpcy5nZXRVc2VySW5wdXQodGhpcy50YXJnZXQgPT09IHRoaXMuYWxpZW4gPyBsYW5lIDogMSAtIGxhbmUsIC8vIGNvcnJlY3QgYW5zd2VyXG4gICAgICAgICAgICAodikgPT4ge1xuICAgICAgICAgICAgICAgIC8vIG9uY2Ugd2UgZ2V0IHRoZSBpbnB1dCByZXN1bWUgdGhlIGF0dGFja1xuICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrLnJlc3VtZSgpO1xuICAgICAgICAgICAgICAgIC8vIG1vdmUgdGhlIHJvY2tldCBpZiBuZWNlc3NhcnlcbiAgICAgICAgICAgICAgICBjb25zdCByb2NrZXRfeCA9IHcgKiAoMSAvIDQgKyB2IC8gMik7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucm9ja2V0LnggPCByb2NrZXRfeCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnR3ZWVucy5hZGQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0czogdGhpcy5yb2NrZXQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9wczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IHsgdmFsdWU6ICgzICogdykgLyA0LCBkdXJhdGlvbjogcGVyaW9kIC8gNCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdGF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBNYXRoLlBJIC8gMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IHBlcmlvZCAvIDgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHlveW86IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLnJvY2tldC54ID4gcm9ja2V0X3gpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50d2VlbnMuYWRkKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMucm9ja2V0LFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcHM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB4OiB7IHZhbHVlOiB3IC8gNCwgZHVyYXRpb246IHBlcmlvZCAvIDQgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3RhdGlvbjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogLU1hdGguUEkgLyAyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogcGVyaW9kIC8gOCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeW95bzogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIFtdLCB0aGlzKTtcbiAgICB9XG4gICAgcm9ja2V0Q29sbGlkZVdpdGhBbGllbigpIHtcbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0ID09IHRoaXMuYWxpZW4pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBvcFNvdW5kKVxuICAgICAgICAgICAgICAgIHRoaXMucG9wU291bmQucGxheSgpO1xuICAgICAgICAgICAgdGhpcy5jYW1lcmFzLm1haW4uZmxhc2goKTtcbiAgICAgICAgICAgIHRoaXMuc2NvcmUgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmV4cGxvZGVTb3VuZClcbiAgICAgICAgICAgICAgICB0aGlzLmV4cGxvZGVTb3VuZC5wbGF5KCk7XG4gICAgICAgICAgICB0aGlzLmNhbWVyYXMubWFpbi5mbGFzaCg1MDAsIDI1NSwgMCwgMCk7XG4gICAgICAgICAgICB0aGlzLnNjb3JlIC09IE1hdGguZmxvb3IodGhpcy5zY29yZSAvIDEwKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBIaWRlIHRoZSB0YXJnZXRcbiAgICAgICAgdGhpcy50YXJnZXQudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAvLyBwcmV2ZW50IG11bHRpcGxlIGNvbGxpc2lvbnNcbiAgICAgICAgdGhpcy5jb2xsaWRlci5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgLy8gYmxvd3VwXG4gICAgICAgIHRoaXMucGFydGljbGVzLmVtaXRQYXJ0aWNsZUF0KHRoaXMudGFyZ2V0LngsIHRoaXMudGFyZ2V0LnkpO1xuICAgICAgICAvLyBkaXNwbGF5IHNjb3JlXG4gICAgICAgIHRoaXMuc2NvcmVEaXNwbGF5LnNldFRleHQoXCJcIiArIHRoaXMuc2NvcmUpO1xuICAgIH1cbn1cbiIsImltcG9ydCBcInBoYXNlclwiO1xuaW1wb3J0IHsgR2FtZVNjZW5lIH0gZnJvbSBcIi4vZ2FtZVwiO1xuaW1wb3J0IHNldHRpbmdzIGZyb20gXCIuL3NldHRpbmdzXCI7XG5jb25zdCBjb25maWcgPSB7XG4gICAgdGl0bGU6IFwiU3BhY2VcIixcbiAgICB0eXBlOiBQaGFzZXIuQVVUTyxcbiAgICB3aWR0aDogNjAwLFxuICAgIGhlaWdodDogODAwLFxuICAgIHNjYWxlOiB7XG4gICAgICAgIG1vZGU6IFBoYXNlci5TY2FsZS5SRVNJWkUsXG4gICAgICAgIGF1dG9DZW50ZXI6IFBoYXNlci5TY2FsZS5DRU5URVJfQk9USFxuICAgIH0sXG4gICAgcGFyZW50OiBcImdhbWVcIixcbiAgICBzY2VuZTogW0dhbWVTY2VuZV0sXG4gICAgcGh5c2ljczoge1xuICAgICAgICBkZWZhdWx0OiBcImFyY2FkZVwiLFxuICAgICAgICBhcmNhZGU6IHtcbiAgICAgICAgICAgIGRlYnVnOiBmYWxzZVxuICAgICAgICB9XG4gICAgfSxcbiAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiIzEwMTAxMFwiXG59O1xuZXhwb3J0IGNsYXNzIE15R2FtZSBleHRlbmRzIFBoYXNlci5HYW1lIHtcbiAgICBjb25zdHJ1Y3Rvcihjb25maWcpIHtcbiAgICAgICAgc3VwZXIoY29uZmlnKTtcbiAgICB9XG59XG53aW5kb3cub25sb2FkID0gKCkgPT4ge1xuICAgIGxldCBnYW1lID0gbnVsbDtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNldHVwXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIGlmIChnYW1lKSB7XG4gICAgICAgICAgICBnYW1lLmRlc3Ryb3kodHJ1ZSk7XG4gICAgICAgICAgICBnYW1lID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC52YWx1ZSA9IFwic2V0dGluZ3NcIjtcbiAgICB9KTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsYXlCdXR0b25cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QudmFsdWUgPSBcInBsYXlcIjtcbiAgICAgICAgZ2FtZSA9IG5ldyBNeUdhbWUoY29uZmlnKTtcbiAgICB9KTtcbiAgICBbLi4uZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcImlucHV0W25hbWU9bW9kZV1cIildLm1hcCgobm9kZSkgPT4gKG5vZGUuY2hlY2tlZCA9IG5vZGUudmFsdWUgPT0gc2V0dGluZ3MubW9kZSkpO1xuICAgIGNvbnN0IHNvdW5kSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNvdW5kXCIpO1xuICAgIHNvdW5kSW5wdXQuY2hlY2tlZCA9IHNldHRpbmdzLnNvdW5kO1xuICAgIGNvbnN0IGFzdGVyb2lkc0lucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhc3Rlcm9pZHNcIik7XG4gICAgYXN0ZXJvaWRzSW5wdXQuY2hlY2tlZCA9IHNldHRpbmdzLmFzdGVyb2lkcztcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNldHRpbmdzXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgZSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiY2hhbmdlXCIpO1xuICAgICAgICBjb25zdCBtb2RlSW5wdXQgPSAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImlucHV0W25hbWU9bW9kZV06Y2hlY2tlZFwiKSk7XG4gICAgICAgIGNvbnN0IG1vZGUgPSBtb2RlSW5wdXQudmFsdWU7XG4gICAgICAgIHNldHRpbmdzLm1vZGUgPSBtb2RlO1xuICAgICAgICBjb25zdCBzb3VuZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzb3VuZFwiKTtcbiAgICAgICAgc2V0dGluZ3Muc291bmQgPSBzb3VuZElucHV0LmNoZWNrZWQ7XG4gICAgICAgIGNvbnN0IGFzdGVyb2lkc0lucHV0ID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXN0ZXJvaWRzXCIpKTtcbiAgICAgICAgc2V0dGluZ3MuYXN0ZXJvaWRzID0gYXN0ZXJvaWRzSW5wdXQuY2hlY2tlZDtcbiAgICAgICAgc2V0dGluZ3MucGVyc2lzdCgpO1xuICAgIH0pO1xufTtcbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///1\n')}]);