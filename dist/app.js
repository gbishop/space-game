!function(I){var g={};function C(A){if(g[A])return g[A].exports;var t=g[A]={i:A,l:!1,exports:{}};return I[A].call(t.exports,t,t.exports,C),t.l=!0,t.exports}C.m=I,C.c=g,C.d=function(I,g,A){C.o(I,g)||Object.defineProperty(I,g,{enumerable:!0,get:A})},C.r=function(I){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})},C.t=function(I,g){if(1&g&&(I=C(I)),8&g)return I;if(4&g&&"object"==typeof I&&I&&I.__esModule)return I;var A=Object.create(null);if(C.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:I}),2&g&&"string"!=typeof I)for(var t in I)C.d(A,t,function(g){return I[g]}.bind(null,t));return A},C.n=function(I){var g=I&&I.__esModule?function(){return I.default}:function(){return I};return C.d(g,"a",g),g},C.o=function(I,g){return Object.prototype.hasOwnProperty.call(I,g)},C.p="",C(C.s=1)}([function(module,exports){eval("module.exports = Phaser;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJQaGFzZXJcIj9lYmM2Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBIiwiZmlsZSI6IjAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IFBoYXNlcjsiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///0\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n\n// EXTERNAL MODULE: external "Phaser"\nvar external_Phaser_ = __webpack_require__(0);\n\n// CONCATENATED MODULE: ./src/settings.ts\nconst key = "space-config";\nconst version = 2;\nclass Settings {\n    constructor() {\n        this.mode = "auto";\n        this.sound = true;\n        this.asteroids = true;\n    }\n    persist() {\n        const data = {\n            version: version,\n            mode: this.mode,\n            sound: this.sound,\n            asteroids: this.asteroids\n        };\n        const json = JSON.stringify(data);\n        localStorage.setItem(key, json);\n    }\n    restore() {\n        const json = localStorage.getItem(key);\n        if (json) {\n            const data = JSON.parse(json);\n            if (data.version == version) {\n                this.mode = data.mode;\n                this.sound = data.sound;\n                this.asteroids = data.asteroids;\n            }\n        }\n    }\n}\nconst settings = new Settings();\nsettings.restore();\n/* harmony default export */ var src_settings = (settings);\n\n// CONCATENATED MODULE: ./src/base.ts\n\n\nclass base_SwitchBase extends Phaser.Scene {\n    constructor(args) {\n        super(args);\n        this.waiting = false;\n    }\n    getUserInput(correct, func) {\n        this.waiting = true;\n        this.correct = correct;\n        this.callback = func;\n        if (src_settings.mode == "auto") {\n            this.time.delayedCall(1000, () => {\n                this.returnInput(this.correct);\n            }, [], this);\n        }\n    }\n    returnInput(value) {\n        if (!this.waiting) {\n            return;\n        }\n        this.setSelected(value);\n        if (src_settings.mode == "one") {\n            value = this.correct;\n        }\n        this.callback(value);\n        this.waiting = false;\n    }\n    setSelected(choice) {\n        const choices = document.querySelectorAll("button.choice");\n        let selected = document.querySelector("button.selected");\n        if (selected) {\n            selected.classList.remove("selected");\n        }\n        choices[choice].classList.add("selected");\n    }\n    create() {\n        console.log("create control");\n        this.input.keyboard.on("keydown-LEFT", (e) => {\n            // pass response back to caller\n            this.returnInput(0);\n        });\n        this.input.keyboard.on("keydown-RIGHT", (e) => {\n            // pass response back to caller\n            this.returnInput(1);\n        });\n        document\n            .getElementById("left")\n            .addEventListener("click", e => this.returnInput(0));\n        document\n            .getElementById("right")\n            .addEventListener("click", e => this.returnInput(1));\n        this.input.keyboard.on("keydown-SPACE", (e) => {\n            const choices = document.querySelectorAll("button.choice");\n            let selected = document.querySelector("button.selected");\n            let i = 0;\n            if (selected) {\n                i = ([...choices].indexOf(selected) + 1) % choices.length;\n                selected.classList.remove("selected");\n            }\n            choices[i].classList.add("selected");\n        });\n        this.input.keyboard.on("keydown-ENTER", (e) => {\n            const selected = (document.querySelector("button.selected"));\n            if (selected) {\n                selected.click();\n            }\n        });\n    }\n}\n\n// CONCATENATED MODULE: ./src/game.ts\n\n\n\nclass game_GameScene extends base_SwitchBase {\n    constructor() {\n        super({\n            key: "GameScene"\n        });\n        this.period = 2000; // time per cycle\n        this.canvas = document.querySelector("canvas");\n        this.rocket_y = 0;\n        this.score = 0;\n        this.popSound = null;\n        this.alienSound = null;\n        this.explodeSound = null;\n    }\n    preload() {\n        // this.load.image("alien", "assets/alien.png");\n        this.load.spritesheet("alien", "assets/alien-sheet.png", {\n            frameWidth: 73,\n            frameHeight: 44,\n            startFrame: 0,\n            endFrame: 39\n        });\n        this.load.spritesheet("asteroid", "assets/asteroid-sheet.png", {\n            frameWidth: 120,\n            frameHeight: 120,\n            startFrame: 0,\n            endFrame: 15\n        });\n        this.load.image("rocket", "assets/rocket.png");\n        this.load.image("particle", "assets/particle.png");\n        if (src_settings.sound) {\n            this.load.audio("pop", "assets/success.mp3");\n            this.load.audio("alienSound", "assets/alien.mp3");\n            this.load.audio("explodeSound", "assets/explode.mp3");\n        }\n    }\n    create() {\n        super.create();\n        console.log("create game");\n        this.scoreDisplay = this.add.text(20, 20, "0", { fontSize: 20 });\n        this.rocket_y = this.canvas.height * 0.9;\n        this.alien = this.add.sprite(this.canvas.width / 2, 10, "alien");\n        for (let i = 0; i < 10; i++) {\n            let name = `ship${i}`;\n            let a = this.anims.create({\n                key: name,\n                frames: this.anims.generateFrameNumbers("alien", {\n                    start: i * 4,\n                    end: i * 4 + 3\n                }),\n                frameRate: 10,\n                repeat: -1\n            });\n            this.alien.anims.load(name);\n        }\n        this.asteroid = this.add.sprite(0, 0, "asteroid");\n        let anim = this.anims.create({\n            key: "spin",\n            frames: this.anims.generateFrameNumbers("asteroid", {}),\n            frameRate: 20,\n            repeat: -1\n        });\n        this.asteroid.anims.load("spin");\n        this.asteroid.anims.play("spin");\n        this.rocket = this.add.sprite((3 * this.canvas.width) / 4, this.rocket_y, "rocket");\n        this.rocket.setScale(0.5);\n        this.moveLeft = this.tweens.add({\n            targets: this.rocket,\n            props: {\n                x: { value: this.canvas.width / 4, duration: 500 },\n                rotation: {\n                    value: -Math.PI / 2,\n                    duration: 250,\n                    yoyo: true,\n                    repeat: 0,\n                    ease: "Sine.easeInOut"\n                }\n            },\n            paused: true\n        });\n        this.moveRight = this.tweens.add({\n            targets: this.rocket,\n            props: {\n                x: { value: (3 * this.canvas.width) / 4, duration: 500 },\n                rotation: { value: Math.PI / 2, duration: 250, yoyo: true, repeat: 0 }\n            },\n            paused: true\n        });\n        // Enable physics on rocket and alien sprites\n        this.physics.world.enable([this.rocket, this.alien, this.asteroid]);\n        this.collider = this.physics.add.overlap(this.rocket, [this.alien, this.asteroid], this.rocketCollideWithAlien, null, this);\n        this.particles = this.add.particles("particle");\n        this.emitter = this.particles.createEmitter({\n            angle: { min: 0, max: 360 },\n            speed: { min: 50, max: 200 },\n            quantity: { min: 40, max: 50 },\n            lifespan: { min: 200, max: 500 },\n            alpha: { start: 1, end: 0 },\n            scale: { min: 0.5, max: 0.5 },\n            rotate: { start: 0, end: 360 },\n            gravityY: 800,\n            on: false\n        });\n        this.reset();\n        if (src_settings.sound) {\n            this.popSound = this.sound.add("pop");\n            this.alienSound = (this.sound.add("alienSound"));\n            this.alienSound.setLoop(true);\n            this.alienSound.play();\n            this.explodeSound = (this.sound.add("explodeSound"));\n        }\n        const starPeriod = 4 * this.period;\n        for (let s = 0; s < 100; s++) {\n            let star = this.add.graphics();\n            star.fillStyle(0xffffff);\n            star.fillPoint(Phaser.Math.Between(0, this.canvas.width), 0, 2);\n            this.tweens.add({\n                targets: star,\n                duration: starPeriod,\n                delay: Phaser.Math.Between(0, starPeriod),\n                repeat: -1,\n                repeatDelay: Phaser.Math.Between(100, 500),\n                y: this.canvas.height,\n                onRepeat: () => {\n                    star.x = Phaser.Math.Between(0, this.canvas.width);\n                }\n            });\n        }\n    }\n    reset() {\n        const w = this.canvas.width;\n        const lane = Phaser.Math.Between(0, 1);\n        const sign = 2 * Phaser.Math.Between(0, 1) - 1;\n        const freq = 0.5 + Math.random() * 2;\n        if (this.score < 20 || Math.random() > 0.2) {\n            this.target = this.alien;\n            const name = `ship${Phaser.Math.Between(0, 9)}`;\n            this.alien.anims.play(name);\n            this.asteroid.y = -100;\n            if (this.alienSound) {\n                this.alienSound.setSeek(0);\n                this.alienSound.setRate(freq);\n                this.alienSound.play();\n            }\n        }\n        else {\n            this.target = this.asteroid;\n            this.alien.y = -100;\n            if (this.alienSound)\n                this.alienSound.stop();\n        }\n        this.target.y = 0;\n        this.attack = this.tweens.add({\n            key: "attack",\n            targets: this.target,\n            y: this.canvas.height,\n            onUpdate: (tween, target) => {\n                const u = target.y / this.canvas.height;\n                const goal_x = this.canvas.width * (1 / 4 + lane / 2);\n                const wiggle = this.canvas.width *\n                    (1 / 2 +\n                        (Math.min(10, this.score) / 20) *\n                            (sign * Math.sin(2 * Math.PI * freq * u)));\n                const v = Math.min(1, target.y / this.rocket_y);\n                target.x = (1 - v) * wiggle + v * goal_x;\n                if (this.alienSound)\n                    this.alienSound.setVolume(u);\n            },\n            onComplete: () => this.reset(),\n            duration: this.period\n        });\n        this.target.setVisible(true);\n        this.collider.active = true;\n        this.time.delayedCall(this.period / 2, () => {\n            this.attack.pause();\n            this.getUserInput(this.target === this.alien ? lane : 1 - lane, (v) => {\n                this.attack.resume();\n                const rocket_x = w / 4 + (v * w) / 2;\n                if (this.rocket.x < rocket_x) {\n                    this.moveRight.play();\n                }\n                else if (this.rocket.x > rocket_x) {\n                    this.moveLeft.play();\n                }\n            });\n        }, [], this);\n    }\n    rocketCollideWithAlien() {\n        if (this.target == this.alien) {\n            if (this.popSound)\n                this.popSound.play();\n            this.cameras.main.flash();\n            this.score += 1;\n        }\n        else {\n            if (this.explodeSound)\n                this.explodeSound.play();\n            this.cameras.main.flash(500, 255, 0, 0);\n            this.score -= 1;\n        }\n        // Hide the target\n        this.target.visible = false;\n        // prevent multiple collisions\n        this.collider.active = false;\n        // blowup\n        this.particles.emitParticleAt(this.target.x, this.target.y);\n        // display score\n        this.scoreDisplay.setText("" + this.score);\n    }\n}\n\n// CONCATENATED MODULE: ./src/app.ts\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "MyGame", function() { return MyGame; });\n\n\n\nconst config = {\n    title: "Space",\n    type: Phaser.AUTO,\n    width: 600,\n    height: 800,\n    scale: {\n        mode: Phaser.Scale.RESIZE,\n        autoCenter: Phaser.Scale.CENTER_BOTH\n    },\n    parent: "game",\n    scene: [game_GameScene],\n    physics: {\n        default: "arcade",\n        arcade: {\n            debug: false\n        }\n    },\n    backgroundColor: "#101010"\n};\nclass MyGame extends Phaser.Game {\n    constructor(config) {\n        super(config);\n    }\n}\nwindow.onload = () => {\n    let game = null;\n    document.getElementById("setup").addEventListener("click", () => {\n        if (game) {\n            game.destroy(true);\n            game = null;\n        }\n        document.body.classList.value = "settings";\n    });\n    document.getElementById("playButton").addEventListener("click", () => {\n        document.body.classList.value = "play";\n        game = new MyGame(config);\n    });\n    [...document.querySelectorAll("input[name=mode]")].map((node) => (node.checked = node.value == src_settings.mode));\n    const soundInput = document.getElementById("sound");\n    soundInput.checked = src_settings.sound;\n    const asteroidsInput = document.getElementById("asteroids");\n    asteroidsInput.checked = src_settings.asteroids;\n    document.getElementById("settings").addEventListener("change", e => {\n        console.log("change");\n        const modeInput = (document.querySelector("input[name=mode]:checked"));\n        const mode = modeInput.value;\n        src_settings.mode = mode;\n        const soundInput = document.getElementById("sound");\n        src_settings.sound = soundInput.checked;\n        const asteroidsInput = (document.getElementById("asteroids"));\n        src_settings.asteroids = asteroidsInput.checked;\n        src_settings.persist();\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvc2V0dGluZ3MudHM/YzIzYyIsIndlYnBhY2s6Ly8vLi9zcmMvYmFzZS50cz9hZTgzIiwid2VicGFjazovLy8uL3NyYy9nYW1lLnRzP2FhZmMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FwcC50cz9mMWIyIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDZSx5REFBUSxFQUFDOzs7QUNoQ1I7QUFDa0I7QUFDM0IsTUFBTSxlQUFVO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFlBQVE7QUFDcEI7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksWUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7OztBQ3JFZ0I7QUFDb0I7QUFDRjtBQUMzQixNQUFNLGNBQVMsU0FBUyxlQUFVO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxZQUFZLFlBQVE7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RCxlQUFlO0FBQ3ZFO0FBQ0E7QUFDQSx1QkFBdUIsUUFBUTtBQUMvQiw4QkFBOEIsRUFBRTtBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtFQUFrRTtBQUNsRTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLDhDQUE4QztBQUNsRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isb0RBQW9EO0FBQ3hFLDJCQUEyQjtBQUMzQixhQUFhO0FBQ2I7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixtQkFBbUI7QUFDdkMsb0JBQW9CLG9CQUFvQjtBQUN4Qyx1QkFBdUIsbUJBQW1CO0FBQzFDLHVCQUF1QixxQkFBcUI7QUFDNUMsb0JBQW9CLG1CQUFtQjtBQUN2QyxvQkFBb0IscUJBQXFCO0FBQ3pDLHFCQUFxQixxQkFBcUI7QUFDMUM7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFlBQVksWUFBUTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixTQUFTO0FBQ2hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQywwQkFBMEI7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDbk5BO0FBQWdCO0FBQ21CO0FBQ0Q7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLFlBQVksY0FBUztBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsbUdBQW1HLFlBQVE7QUFDM0c7QUFDQSx5QkFBeUIsWUFBUTtBQUNqQztBQUNBLDZCQUE2QixZQUFRO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxZQUFRO0FBQ2hCO0FBQ0EsUUFBUSxZQUFRO0FBQ2hCO0FBQ0EsUUFBUSxZQUFRO0FBQ2hCLFFBQVEsWUFBUTtBQUNoQixLQUFLO0FBQ0wiLCJmaWxlIjoiMS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGtleSA9IFwic3BhY2UtY29uZmlnXCI7XG5jb25zdCB2ZXJzaW9uID0gMjtcbmNsYXNzIFNldHRpbmdzIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5tb2RlID0gXCJhdXRvXCI7XG4gICAgICAgIHRoaXMuc291bmQgPSB0cnVlO1xuICAgICAgICB0aGlzLmFzdGVyb2lkcyA9IHRydWU7XG4gICAgfVxuICAgIHBlcnNpc3QoKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSB7XG4gICAgICAgICAgICB2ZXJzaW9uOiB2ZXJzaW9uLFxuICAgICAgICAgICAgbW9kZTogdGhpcy5tb2RlLFxuICAgICAgICAgICAgc291bmQ6IHRoaXMuc291bmQsXG4gICAgICAgICAgICBhc3Rlcm9pZHM6IHRoaXMuYXN0ZXJvaWRzXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGpzb24gPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBqc29uKTtcbiAgICB9XG4gICAgcmVzdG9yZSgpIHtcbiAgICAgICAgY29uc3QganNvbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgICAgIGlmIChqc29uKSB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShqc29uKTtcbiAgICAgICAgICAgIGlmIChkYXRhLnZlcnNpb24gPT0gdmVyc2lvbikge1xuICAgICAgICAgICAgICAgIHRoaXMubW9kZSA9IGRhdGEubW9kZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNvdW5kID0gZGF0YS5zb3VuZDtcbiAgICAgICAgICAgICAgICB0aGlzLmFzdGVyb2lkcyA9IGRhdGEuYXN0ZXJvaWRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuY29uc3Qgc2V0dGluZ3MgPSBuZXcgU2V0dGluZ3MoKTtcbnNldHRpbmdzLnJlc3RvcmUoKTtcbmV4cG9ydCBkZWZhdWx0IHNldHRpbmdzO1xuIiwiaW1wb3J0IFwicGhhc2VyXCI7XG5pbXBvcnQgc2V0dGluZ3MgZnJvbSBcIi4vc2V0dGluZ3NcIjtcbmV4cG9ydCBjbGFzcyBTd2l0Y2hCYXNlIGV4dGVuZHMgUGhhc2VyLlNjZW5lIHtcbiAgICBjb25zdHJ1Y3RvcihhcmdzKSB7XG4gICAgICAgIHN1cGVyKGFyZ3MpO1xuICAgICAgICB0aGlzLndhaXRpbmcgPSBmYWxzZTtcbiAgICB9XG4gICAgZ2V0VXNlcklucHV0KGNvcnJlY3QsIGZ1bmMpIHtcbiAgICAgICAgdGhpcy53YWl0aW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5jb3JyZWN0ID0gY29ycmVjdDtcbiAgICAgICAgdGhpcy5jYWxsYmFjayA9IGZ1bmM7XG4gICAgICAgIGlmIChzZXR0aW5ncy5tb2RlID09IFwiYXV0b1wiKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWUuZGVsYXllZENhbGwoMTAwMCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMucmV0dXJuSW5wdXQodGhpcy5jb3JyZWN0KTtcbiAgICAgICAgICAgIH0sIFtdLCB0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm5JbnB1dCh2YWx1ZSkge1xuICAgICAgICBpZiAoIXRoaXMud2FpdGluZykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0ZWQodmFsdWUpO1xuICAgICAgICBpZiAoc2V0dGluZ3MubW9kZSA9PSBcIm9uZVwiKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHRoaXMuY29ycmVjdDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbGxiYWNrKHZhbHVlKTtcbiAgICAgICAgdGhpcy53YWl0aW5nID0gZmFsc2U7XG4gICAgfVxuICAgIHNldFNlbGVjdGVkKGNob2ljZSkge1xuICAgICAgICBjb25zdCBjaG9pY2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcImJ1dHRvbi5jaG9pY2VcIik7XG4gICAgICAgIGxldCBzZWxlY3RlZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24uc2VsZWN0ZWRcIik7XG4gICAgICAgIGlmIChzZWxlY3RlZCkge1xuICAgICAgICAgICAgc2VsZWN0ZWQuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xuICAgICAgICB9XG4gICAgICAgIGNob2ljZXNbY2hvaWNlXS5jbGFzc0xpc3QuYWRkKFwic2VsZWN0ZWRcIik7XG4gICAgfVxuICAgIGNyZWF0ZSgpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjcmVhdGUgY29udHJvbFwiKTtcbiAgICAgICAgdGhpcy5pbnB1dC5rZXlib2FyZC5vbihcImtleWRvd24tTEVGVFwiLCAoZSkgPT4ge1xuICAgICAgICAgICAgLy8gcGFzcyByZXNwb25zZSBiYWNrIHRvIGNhbGxlclxuICAgICAgICAgICAgdGhpcy5yZXR1cm5JbnB1dCgwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuaW5wdXQua2V5Ym9hcmQub24oXCJrZXlkb3duLVJJR0hUXCIsIChlKSA9PiB7XG4gICAgICAgICAgICAvLyBwYXNzIHJlc3BvbnNlIGJhY2sgdG8gY2FsbGVyXG4gICAgICAgICAgICB0aGlzLnJldHVybklucHV0KDEpO1xuICAgICAgICB9KTtcbiAgICAgICAgZG9jdW1lbnRcbiAgICAgICAgICAgIC5nZXRFbGVtZW50QnlJZChcImxlZnRcIilcbiAgICAgICAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB0aGlzLnJldHVybklucHV0KDApKTtcbiAgICAgICAgZG9jdW1lbnRcbiAgICAgICAgICAgIC5nZXRFbGVtZW50QnlJZChcInJpZ2h0XCIpXG4gICAgICAgICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4gdGhpcy5yZXR1cm5JbnB1dCgxKSk7XG4gICAgICAgIHRoaXMuaW5wdXQua2V5Ym9hcmQub24oXCJrZXlkb3duLVNQQUNFXCIsIChlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjaG9pY2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcImJ1dHRvbi5jaG9pY2VcIik7XG4gICAgICAgICAgICBsZXQgc2VsZWN0ZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uLnNlbGVjdGVkXCIpO1xuICAgICAgICAgICAgbGV0IGkgPSAwO1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgaSA9IChbLi4uY2hvaWNlc10uaW5kZXhPZihzZWxlY3RlZCkgKyAxKSAlIGNob2ljZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNob2ljZXNbaV0uY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pbnB1dC5rZXlib2FyZC5vbihcImtleWRvd24tRU5URVJcIiwgKGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b24uc2VsZWN0ZWRcIikpO1xuICAgICAgICAgICAgaWYgKHNlbGVjdGVkKSB7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQuY2xpY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuIiwiaW1wb3J0IFwicGhhc2VyXCI7XG5pbXBvcnQgeyBTd2l0Y2hCYXNlIH0gZnJvbSBcIi4vYmFzZVwiO1xuaW1wb3J0IHNldHRpbmdzIGZyb20gXCIuL3NldHRpbmdzXCI7XG5leHBvcnQgY2xhc3MgR2FtZVNjZW5lIGV4dGVuZHMgU3dpdGNoQmFzZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKHtcbiAgICAgICAgICAgIGtleTogXCJHYW1lU2NlbmVcIlxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wZXJpb2QgPSAyMDAwOyAvLyB0aW1lIHBlciBjeWNsZVxuICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJjYW52YXNcIik7XG4gICAgICAgIHRoaXMucm9ja2V0X3kgPSAwO1xuICAgICAgICB0aGlzLnNjb3JlID0gMDtcbiAgICAgICAgdGhpcy5wb3BTb3VuZCA9IG51bGw7XG4gICAgICAgIHRoaXMuYWxpZW5Tb3VuZCA9IG51bGw7XG4gICAgICAgIHRoaXMuZXhwbG9kZVNvdW5kID0gbnVsbDtcbiAgICB9XG4gICAgcHJlbG9hZCgpIHtcbiAgICAgICAgLy8gdGhpcy5sb2FkLmltYWdlKFwiYWxpZW5cIiwgXCJhc3NldHMvYWxpZW4ucG5nXCIpO1xuICAgICAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoXCJhbGllblwiLCBcImFzc2V0cy9hbGllbi1zaGVldC5wbmdcIiwge1xuICAgICAgICAgICAgZnJhbWVXaWR0aDogNzMsXG4gICAgICAgICAgICBmcmFtZUhlaWdodDogNDQsXG4gICAgICAgICAgICBzdGFydEZyYW1lOiAwLFxuICAgICAgICAgICAgZW5kRnJhbWU6IDM5XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmxvYWQuc3ByaXRlc2hlZXQoXCJhc3Rlcm9pZFwiLCBcImFzc2V0cy9hc3Rlcm9pZC1zaGVldC5wbmdcIiwge1xuICAgICAgICAgICAgZnJhbWVXaWR0aDogMTIwLFxuICAgICAgICAgICAgZnJhbWVIZWlnaHQ6IDEyMCxcbiAgICAgICAgICAgIHN0YXJ0RnJhbWU6IDAsXG4gICAgICAgICAgICBlbmRGcmFtZTogMTVcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInJvY2tldFwiLCBcImFzc2V0cy9yb2NrZXQucG5nXCIpO1xuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJwYXJ0aWNsZVwiLCBcImFzc2V0cy9wYXJ0aWNsZS5wbmdcIik7XG4gICAgICAgIGlmIChzZXR0aW5ncy5zb3VuZCkge1xuICAgICAgICAgICAgdGhpcy5sb2FkLmF1ZGlvKFwicG9wXCIsIFwiYXNzZXRzL3N1Y2Nlc3MubXAzXCIpO1xuICAgICAgICAgICAgdGhpcy5sb2FkLmF1ZGlvKFwiYWxpZW5Tb3VuZFwiLCBcImFzc2V0cy9hbGllbi5tcDNcIik7XG4gICAgICAgICAgICB0aGlzLmxvYWQuYXVkaW8oXCJleHBsb2RlU291bmRcIiwgXCJhc3NldHMvZXhwbG9kZS5tcDNcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3JlYXRlKCkge1xuICAgICAgICBzdXBlci5jcmVhdGUoKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJjcmVhdGUgZ2FtZVwiKTtcbiAgICAgICAgdGhpcy5zY29yZURpc3BsYXkgPSB0aGlzLmFkZC50ZXh0KDIwLCAyMCwgXCIwXCIsIHsgZm9udFNpemU6IDIwIH0pO1xuICAgICAgICB0aGlzLnJvY2tldF95ID0gdGhpcy5jYW52YXMuaGVpZ2h0ICogMC45O1xuICAgICAgICB0aGlzLmFsaWVuID0gdGhpcy5hZGQuc3ByaXRlKHRoaXMuY2FudmFzLndpZHRoIC8gMiwgMTAsIFwiYWxpZW5cIik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgICAgICAgbGV0IG5hbWUgPSBgc2hpcCR7aX1gO1xuICAgICAgICAgICAgbGV0IGEgPSB0aGlzLmFuaW1zLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAga2V5OiBuYW1lLFxuICAgICAgICAgICAgICAgIGZyYW1lczogdGhpcy5hbmltcy5nZW5lcmF0ZUZyYW1lTnVtYmVycyhcImFsaWVuXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IGkgKiA0LFxuICAgICAgICAgICAgICAgICAgICBlbmQ6IGkgKiA0ICsgM1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGZyYW1lUmF0ZTogMTAsXG4gICAgICAgICAgICAgICAgcmVwZWF0OiAtMVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmFsaWVuLmFuaW1zLmxvYWQobmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hc3Rlcm9pZCA9IHRoaXMuYWRkLnNwcml0ZSgwLCAwLCBcImFzdGVyb2lkXCIpO1xuICAgICAgICBsZXQgYW5pbSA9IHRoaXMuYW5pbXMuY3JlYXRlKHtcbiAgICAgICAgICAgIGtleTogXCJzcGluXCIsXG4gICAgICAgICAgICBmcmFtZXM6IHRoaXMuYW5pbXMuZ2VuZXJhdGVGcmFtZU51bWJlcnMoXCJhc3Rlcm9pZFwiLCB7fSksXG4gICAgICAgICAgICBmcmFtZVJhdGU6IDIwLFxuICAgICAgICAgICAgcmVwZWF0OiAtMVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5hc3Rlcm9pZC5hbmltcy5sb2FkKFwic3BpblwiKTtcbiAgICAgICAgdGhpcy5hc3Rlcm9pZC5hbmltcy5wbGF5KFwic3BpblwiKTtcbiAgICAgICAgdGhpcy5yb2NrZXQgPSB0aGlzLmFkZC5zcHJpdGUoKDMgKiB0aGlzLmNhbnZhcy53aWR0aCkgLyA0LCB0aGlzLnJvY2tldF95LCBcInJvY2tldFwiKTtcbiAgICAgICAgdGhpcy5yb2NrZXQuc2V0U2NhbGUoMC41KTtcbiAgICAgICAgdGhpcy5tb3ZlTGVmdCA9IHRoaXMudHdlZW5zLmFkZCh7XG4gICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnJvY2tldCxcbiAgICAgICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgICAgICAgeDogeyB2YWx1ZTogdGhpcy5jYW52YXMud2lkdGggLyA0LCBkdXJhdGlvbjogNTAwIH0sXG4gICAgICAgICAgICAgICAgcm90YXRpb246IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IC1NYXRoLlBJIC8gMixcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDI1MCxcbiAgICAgICAgICAgICAgICAgICAgeW95bzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgcmVwZWF0OiAwLFxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBcIlNpbmUuZWFzZUluT3V0XCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGF1c2VkOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLm1vdmVSaWdodCA9IHRoaXMudHdlZW5zLmFkZCh7XG4gICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnJvY2tldCxcbiAgICAgICAgICAgIHByb3BzOiB7XG4gICAgICAgICAgICAgICAgeDogeyB2YWx1ZTogKDMgKiB0aGlzLmNhbnZhcy53aWR0aCkgLyA0LCBkdXJhdGlvbjogNTAwIH0sXG4gICAgICAgICAgICAgICAgcm90YXRpb246IHsgdmFsdWU6IE1hdGguUEkgLyAyLCBkdXJhdGlvbjogMjUwLCB5b3lvOiB0cnVlLCByZXBlYXQ6IDAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBhdXNlZDogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gRW5hYmxlIHBoeXNpY3Mgb24gcm9ja2V0IGFuZCBhbGllbiBzcHJpdGVzXG4gICAgICAgIHRoaXMucGh5c2ljcy53b3JsZC5lbmFibGUoW3RoaXMucm9ja2V0LCB0aGlzLmFsaWVuLCB0aGlzLmFzdGVyb2lkXSk7XG4gICAgICAgIHRoaXMuY29sbGlkZXIgPSB0aGlzLnBoeXNpY3MuYWRkLm92ZXJsYXAodGhpcy5yb2NrZXQsIFt0aGlzLmFsaWVuLCB0aGlzLmFzdGVyb2lkXSwgdGhpcy5yb2NrZXRDb2xsaWRlV2l0aEFsaWVuLCBudWxsLCB0aGlzKTtcbiAgICAgICAgdGhpcy5wYXJ0aWNsZXMgPSB0aGlzLmFkZC5wYXJ0aWNsZXMoXCJwYXJ0aWNsZVwiKTtcbiAgICAgICAgdGhpcy5lbWl0dGVyID0gdGhpcy5wYXJ0aWNsZXMuY3JlYXRlRW1pdHRlcih7XG4gICAgICAgICAgICBhbmdsZTogeyBtaW46IDAsIG1heDogMzYwIH0sXG4gICAgICAgICAgICBzcGVlZDogeyBtaW46IDUwLCBtYXg6IDIwMCB9LFxuICAgICAgICAgICAgcXVhbnRpdHk6IHsgbWluOiA0MCwgbWF4OiA1MCB9LFxuICAgICAgICAgICAgbGlmZXNwYW46IHsgbWluOiAyMDAsIG1heDogNTAwIH0sXG4gICAgICAgICAgICBhbHBoYTogeyBzdGFydDogMSwgZW5kOiAwIH0sXG4gICAgICAgICAgICBzY2FsZTogeyBtaW46IDAuNSwgbWF4OiAwLjUgfSxcbiAgICAgICAgICAgIHJvdGF0ZTogeyBzdGFydDogMCwgZW5kOiAzNjAgfSxcbiAgICAgICAgICAgIGdyYXZpdHlZOiA4MDAsXG4gICAgICAgICAgICBvbjogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgaWYgKHNldHRpbmdzLnNvdW5kKSB7XG4gICAgICAgICAgICB0aGlzLnBvcFNvdW5kID0gdGhpcy5zb3VuZC5hZGQoXCJwb3BcIik7XG4gICAgICAgICAgICB0aGlzLmFsaWVuU291bmQgPSAodGhpcy5zb3VuZC5hZGQoXCJhbGllblNvdW5kXCIpKTtcbiAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZC5zZXRMb29wKHRydWUpO1xuICAgICAgICAgICAgdGhpcy5hbGllblNvdW5kLnBsYXkoKTtcbiAgICAgICAgICAgIHRoaXMuZXhwbG9kZVNvdW5kID0gKHRoaXMuc291bmQuYWRkKFwiZXhwbG9kZVNvdW5kXCIpKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzdGFyUGVyaW9kID0gNCAqIHRoaXMucGVyaW9kO1xuICAgICAgICBmb3IgKGxldCBzID0gMDsgcyA8IDEwMDsgcysrKSB7XG4gICAgICAgICAgICBsZXQgc3RhciA9IHRoaXMuYWRkLmdyYXBoaWNzKCk7XG4gICAgICAgICAgICBzdGFyLmZpbGxTdHlsZSgweGZmZmZmZik7XG4gICAgICAgICAgICBzdGFyLmZpbGxQb2ludChQaGFzZXIuTWF0aC5CZXR3ZWVuKDAsIHRoaXMuY2FudmFzLndpZHRoKSwgMCwgMik7XG4gICAgICAgICAgICB0aGlzLnR3ZWVucy5hZGQoe1xuICAgICAgICAgICAgICAgIHRhcmdldHM6IHN0YXIsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IHN0YXJQZXJpb2QsXG4gICAgICAgICAgICAgICAgZGVsYXk6IFBoYXNlci5NYXRoLkJldHdlZW4oMCwgc3RhclBlcmlvZCksXG4gICAgICAgICAgICAgICAgcmVwZWF0OiAtMSxcbiAgICAgICAgICAgICAgICByZXBlYXREZWxheTogUGhhc2VyLk1hdGguQmV0d2VlbigxMDAsIDUwMCksXG4gICAgICAgICAgICAgICAgeTogdGhpcy5jYW52YXMuaGVpZ2h0LFxuICAgICAgICAgICAgICAgIG9uUmVwZWF0OiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHN0YXIueCA9IFBoYXNlci5NYXRoLkJldHdlZW4oMCwgdGhpcy5jYW52YXMud2lkdGgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlc2V0KCkge1xuICAgICAgICBjb25zdCB3ID0gdGhpcy5jYW52YXMud2lkdGg7XG4gICAgICAgIGNvbnN0IGxhbmUgPSBQaGFzZXIuTWF0aC5CZXR3ZWVuKDAsIDEpO1xuICAgICAgICBjb25zdCBzaWduID0gMiAqIFBoYXNlci5NYXRoLkJldHdlZW4oMCwgMSkgLSAxO1xuICAgICAgICBjb25zdCBmcmVxID0gMC41ICsgTWF0aC5yYW5kb20oKSAqIDI7XG4gICAgICAgIGlmICh0aGlzLnNjb3JlIDwgMjAgfHwgTWF0aC5yYW5kb20oKSA+IDAuMikge1xuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0aGlzLmFsaWVuO1xuICAgICAgICAgICAgY29uc3QgbmFtZSA9IGBzaGlwJHtQaGFzZXIuTWF0aC5CZXR3ZWVuKDAsIDkpfWA7XG4gICAgICAgICAgICB0aGlzLmFsaWVuLmFuaW1zLnBsYXkobmFtZSk7XG4gICAgICAgICAgICB0aGlzLmFzdGVyb2lkLnkgPSAtMTAwO1xuICAgICAgICAgICAgaWYgKHRoaXMuYWxpZW5Tb3VuZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZC5zZXRTZWVrKDApO1xuICAgICAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZC5zZXRSYXRlKGZyZXEpO1xuICAgICAgICAgICAgICAgIHRoaXMuYWxpZW5Tb3VuZC5wbGF5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRhcmdldCA9IHRoaXMuYXN0ZXJvaWQ7XG4gICAgICAgICAgICB0aGlzLmFsaWVuLnkgPSAtMTAwO1xuICAgICAgICAgICAgaWYgKHRoaXMuYWxpZW5Tb3VuZClcbiAgICAgICAgICAgICAgICB0aGlzLmFsaWVuU291bmQuc3RvcCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudGFyZ2V0LnkgPSAwO1xuICAgICAgICB0aGlzLmF0dGFjayA9IHRoaXMudHdlZW5zLmFkZCh7XG4gICAgICAgICAgICBrZXk6IFwiYXR0YWNrXCIsXG4gICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnRhcmdldCxcbiAgICAgICAgICAgIHk6IHRoaXMuY2FudmFzLmhlaWdodCxcbiAgICAgICAgICAgIG9uVXBkYXRlOiAodHdlZW4sIHRhcmdldCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHUgPSB0YXJnZXQueSAvIHRoaXMuY2FudmFzLmhlaWdodDtcbiAgICAgICAgICAgICAgICBjb25zdCBnb2FsX3ggPSB0aGlzLmNhbnZhcy53aWR0aCAqICgxIC8gNCArIGxhbmUgLyAyKTtcbiAgICAgICAgICAgICAgICBjb25zdCB3aWdnbGUgPSB0aGlzLmNhbnZhcy53aWR0aCAqXG4gICAgICAgICAgICAgICAgICAgICgxIC8gMiArXG4gICAgICAgICAgICAgICAgICAgICAgICAoTWF0aC5taW4oMTAsIHRoaXMuc2NvcmUpIC8gMjApICpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc2lnbiAqIE1hdGguc2luKDIgKiBNYXRoLlBJICogZnJlcSAqIHUpKSk7XG4gICAgICAgICAgICAgICAgY29uc3QgdiA9IE1hdGgubWluKDEsIHRhcmdldC55IC8gdGhpcy5yb2NrZXRfeSk7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LnggPSAoMSAtIHYpICogd2lnZ2xlICsgdiAqIGdvYWxfeDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hbGllblNvdW5kKVxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFsaWVuU291bmQuc2V0Vm9sdW1lKHUpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6ICgpID0+IHRoaXMucmVzZXQoKSxcbiAgICAgICAgICAgIGR1cmF0aW9uOiB0aGlzLnBlcmlvZFxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy50YXJnZXQuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgdGhpcy5jb2xsaWRlci5hY3RpdmUgPSB0cnVlO1xuICAgICAgICB0aGlzLnRpbWUuZGVsYXllZENhbGwodGhpcy5wZXJpb2QgLyAyLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmF0dGFjay5wYXVzZSgpO1xuICAgICAgICAgICAgdGhpcy5nZXRVc2VySW5wdXQodGhpcy50YXJnZXQgPT09IHRoaXMuYWxpZW4gPyBsYW5lIDogMSAtIGxhbmUsICh2KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2sucmVzdW1lKCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9ja2V0X3ggPSB3IC8gNCArICh2ICogdykgLyAyO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJvY2tldC54IDwgcm9ja2V0X3gpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlUmlnaHQucGxheSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLnJvY2tldC54ID4gcm9ja2V0X3gpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlTGVmdC5wbGF5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sIFtdLCB0aGlzKTtcbiAgICB9XG4gICAgcm9ja2V0Q29sbGlkZVdpdGhBbGllbigpIHtcbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0ID09IHRoaXMuYWxpZW4pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBvcFNvdW5kKVxuICAgICAgICAgICAgICAgIHRoaXMucG9wU291bmQucGxheSgpO1xuICAgICAgICAgICAgdGhpcy5jYW1lcmFzLm1haW4uZmxhc2goKTtcbiAgICAgICAgICAgIHRoaXMuc2NvcmUgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmV4cGxvZGVTb3VuZClcbiAgICAgICAgICAgICAgICB0aGlzLmV4cGxvZGVTb3VuZC5wbGF5KCk7XG4gICAgICAgICAgICB0aGlzLmNhbWVyYXMubWFpbi5mbGFzaCg1MDAsIDI1NSwgMCwgMCk7XG4gICAgICAgICAgICB0aGlzLnNjb3JlIC09IDE7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSGlkZSB0aGUgdGFyZ2V0XG4gICAgICAgIHRoaXMudGFyZ2V0LnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgLy8gcHJldmVudCBtdWx0aXBsZSBjb2xsaXNpb25zXG4gICAgICAgIHRoaXMuY29sbGlkZXIuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgIC8vIGJsb3d1cFxuICAgICAgICB0aGlzLnBhcnRpY2xlcy5lbWl0UGFydGljbGVBdCh0aGlzLnRhcmdldC54LCB0aGlzLnRhcmdldC55KTtcbiAgICAgICAgLy8gZGlzcGxheSBzY29yZVxuICAgICAgICB0aGlzLnNjb3JlRGlzcGxheS5zZXRUZXh0KFwiXCIgKyB0aGlzLnNjb3JlKTtcbiAgICB9XG59XG4iLCJpbXBvcnQgXCJwaGFzZXJcIjtcbmltcG9ydCB7IEdhbWVTY2VuZSB9IGZyb20gXCIuL2dhbWVcIjtcbmltcG9ydCBzZXR0aW5ncyBmcm9tIFwiLi9zZXR0aW5nc1wiO1xuY29uc3QgY29uZmlnID0ge1xuICAgIHRpdGxlOiBcIlNwYWNlXCIsXG4gICAgdHlwZTogUGhhc2VyLkFVVE8sXG4gICAgd2lkdGg6IDYwMCxcbiAgICBoZWlnaHQ6IDgwMCxcbiAgICBzY2FsZToge1xuICAgICAgICBtb2RlOiBQaGFzZXIuU2NhbGUuUkVTSVpFLFxuICAgICAgICBhdXRvQ2VudGVyOiBQaGFzZXIuU2NhbGUuQ0VOVEVSX0JPVEhcbiAgICB9LFxuICAgIHBhcmVudDogXCJnYW1lXCIsXG4gICAgc2NlbmU6IFtHYW1lU2NlbmVdLFxuICAgIHBoeXNpY3M6IHtcbiAgICAgICAgZGVmYXVsdDogXCJhcmNhZGVcIixcbiAgICAgICAgYXJjYWRlOiB7XG4gICAgICAgICAgICBkZWJ1ZzogZmFsc2VcbiAgICAgICAgfVxuICAgIH0sXG4gICAgYmFja2dyb3VuZENvbG9yOiBcIiMxMDEwMTBcIlxufTtcbmV4cG9ydCBjbGFzcyBNeUdhbWUgZXh0ZW5kcyBQaGFzZXIuR2FtZSB7XG4gICAgY29uc3RydWN0b3IoY29uZmlnKSB7XG4gICAgICAgIHN1cGVyKGNvbmZpZyk7XG4gICAgfVxufVxud2luZG93Lm9ubG9hZCA9ICgpID0+IHtcbiAgICBsZXQgZ2FtZSA9IG51bGw7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZXR1cFwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBpZiAoZ2FtZSkge1xuICAgICAgICAgICAgZ2FtZS5kZXN0cm95KHRydWUpO1xuICAgICAgICAgICAgZ2FtZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QudmFsdWUgPSBcInNldHRpbmdzXCI7XG4gICAgfSk7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJwbGF5QnV0dG9uXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnZhbHVlID0gXCJwbGF5XCI7XG4gICAgICAgIGdhbWUgPSBuZXcgTXlHYW1lKGNvbmZpZyk7XG4gICAgfSk7XG4gICAgWy4uLmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJpbnB1dFtuYW1lPW1vZGVdXCIpXS5tYXAoKG5vZGUpID0+IChub2RlLmNoZWNrZWQgPSBub2RlLnZhbHVlID09IHNldHRpbmdzLm1vZGUpKTtcbiAgICBjb25zdCBzb3VuZElucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzb3VuZFwiKTtcbiAgICBzb3VuZElucHV0LmNoZWNrZWQgPSBzZXR0aW5ncy5zb3VuZDtcbiAgICBjb25zdCBhc3Rlcm9pZHNJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXN0ZXJvaWRzXCIpO1xuICAgIGFzdGVyb2lkc0lucHV0LmNoZWNrZWQgPSBzZXR0aW5ncy5hc3Rlcm9pZHM7XG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzZXR0aW5nc1wiKS5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIGUgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcImNoYW5nZVwiKTtcbiAgICAgICAgY29uc3QgbW9kZUlucHV0ID0gKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFtuYW1lPW1vZGVdOmNoZWNrZWRcIikpO1xuICAgICAgICBjb25zdCBtb2RlID0gbW9kZUlucHV0LnZhbHVlO1xuICAgICAgICBzZXR0aW5ncy5tb2RlID0gbW9kZTtcbiAgICAgICAgY29uc3Qgc291bmRJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic291bmRcIik7XG4gICAgICAgIHNldHRpbmdzLnNvdW5kID0gc291bmRJbnB1dC5jaGVja2VkO1xuICAgICAgICBjb25zdCBhc3Rlcm9pZHNJbnB1dCA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFzdGVyb2lkc1wiKSk7XG4gICAgICAgIHNldHRpbmdzLmFzdGVyb2lkcyA9IGFzdGVyb2lkc0lucHV0LmNoZWNrZWQ7XG4gICAgICAgIHNldHRpbmdzLnBlcnNpc3QoKTtcbiAgICB9KTtcbn07XG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1\n')}]);